---
title: 翻译、编译、解释、汇编
date: 2021-08-17 10:03:06
tags:
- 计算机科学基础
categories:
- 计算机科学基础
---

# 翻译程序
翻译程序是指把高级语言源程序翻译成机器语言程序（目标代码）的软件。

翻译程序包括编译程序和解释程序。

# 编译程序
编译程序将高级语言源程序一次全部翻译成目标程序，每次执行程序时，只需执行目标程序，因此只要源程序不变，就无须重新编译。

虽然高级语言号称跨平台、可移植，但是同一种高级语言在不同计算机体系结构下，编译生成的目标程序是不同的。目标程序与体系结构相关，可惜仍不是计算机硬件能够直接执行的程序。

# 汇编程序
汇编程序也是一种语言翻译程序，它把汇编语言源程序翻译成机器语言程序。

汇编语言是一种面向机器的低级语言，是机器语言的符号表示，与机器语言一一对应。

需要注意的是，编译后生成的目标文件不是汇编语言源程序，比如Java编译后生成的.class。

参考代码：
```shell
section .data
msg db 'Hello, Assembly!', 0x0a ; 创建字符串变量
len	equ	$ - msg                 ; 获取字符串的长度
 
section .text
global _start                   ; 使用gcc

_start:                         ; 汇编程序执行的入口
    mov	edx, len                ; 加载字符串长度
    mov ecx, msg                ; 加载.data部分中创建的变量的内存地址
    mov ebx, 1                  ; 向stdout中写入字符串
    mov eax, 4                  ; 系统调用sys_write
    int 0x80                    ; restart_syscall，`int 80h`也行
    mov	eax, 1                  ; 系统调用sys_exit
	int	0x80                    ; restart_syscall
```

学习资料：
- [汇编语言在线调试环境](https://www.tutorialspoint.com/compile_assembly_online.php)
- [汇编语言在线教程](https://asmtutor.com)
- [Linux系统调用表](https://chromium.googlesource.com/chromiumos/docs/+/HEAD/constants/syscalls.md)

# 解释程序
解释程序将源程序的一条语句翻译成对应的机器目标代码，并立即执行，然后翻译下一条源程序语句并执行，直至所有源程序语句全部被执行完，不会生成目标程序。

# 编译型语言和解释型语言

编译型语言的程序执行之前，需要一个编译的过程，把程序编译成为机器语言的文件，例如exe文件，运行时不用重新翻译。由于翻译只进行一次，运行时不需要翻译，所以编译型语言的程序执行效率较高。C、C++、Rust等都是典型的编译型语言。

解释型语言是相对于编译型语言存在的，其源代码不是直接翻译成机器语言，而是先翻译成中间代码，再由解释器对中间代码进行解释运行。Python、JavaScript、Perl、Shell等脚本语言都是解释型语言。

解释型语言的程序不需要编译，程序在运行时才翻译成机器语言，每执行一次都要翻译一次。因此效率比较低。

编译型语言与解释型语言，两者各有利弊。
前者由于程序执行速度快，同等条件下对系统要求较低，因此开发操作系统、大型应用程序、数据库系统等时会采用它们。
后者由于对速度要求不高、对不同系统平台间的兼容性有一定要求，因此编写网页脚本、服务器脚本及辅助开发接口时会采用它们。

编译型语言不如解释型语言跨平台性好。
编译型语言开发程序后，需要通过编译器把程序编译成机器语言。解释型语言程序进行移植后，要重新编译。
Java虽然需要编译，但本质是解释型语言，需要通过编译器编译成class文件，在什么平台运行需要对应平台的解释器。跨平台的前提是平台上必须要有相匹配的JVM。

## C程序编译

C程序可以在许多不同的机器上运行。这种可移植性是C语言的另一个优点。程序首先在目标机器上使用C编译器编译。存在略有不同的C编译器版本，包括cc（C编译器），或者gcc（GNU C编译器）。

这里我们用gcc编译并运行一个C程序，该编译器可以免费下载。它可以直接运行在Linux机器上，也可以在Windows机器上通过Cygwin环境访问。它可以用于许多嵌入式系统，如Microchip PIC32微控制器。

下面描述的C文件创建、编译和执行的一般过程对于任何C程序都是相同的。
 1. 创建文本文件（Windows可用经典的记事本，但是不要用Word这种有格式化的，和Java要求一样）。我们这里取名为hello.c。
 2. 在终端窗口中，切换到hello.c文件的目录，在命令提示符处输入`gcc hello.c`。
 3. 编译器创建一个可执行文件。默认情况下，可执行文件名为a.out（Windows机器上是a.exe）。
 4. 在命令提示符处，键入 `./a.out`（Windows为 `./a.exe`），然后按回车。
 5. 终端窗口显示输出。

gcc也可以编译一组多个C源文件。这样的一组C文件中只能包含一个main()函数，通常在main.c中，切记切记。
编译命令：
```shell
gcc main.c file2.c file3.c
```

命令行中输入`gcc --help`可以查看编译器选项：

| 编译器选项 | 描述 | 示例 |
|--|--|--|
| -ooutfile | 指定输出文件名 | gcc -o hello hello.c |
| -S | 创建汇编语言输出文件（不可执行） | gcc -S hello.c this produces hello.s |
| -v | 详细模式——在完成编译时输出编译结果和过程 | gcc -v hello.c |
| -Olevel | 指定优化水平（通常为0~3），生成更快和更小的代码，但是代价是编译时间长 | gcc -O2 hello.c |
| --version | 列出编译器版本 | gcc -version |
| --help | 列出所有命令行选项 | gcc - -help |
| --Wall | 输出所有警告 | gcc -Wall hello.c |

argc表示命令行上参数的个数。argv表示参数向量，为命令行上发现的字符串数组。

```c
#include<stdio.h>

int main(int argc, char *argv[]){
    int i;
    for (i=0; i<argc; i++){
        printf("argv[%d]=%s\n", i, argv[i]);
    }
}
```

编译：
```c
gcc -o testargs.c ./testargs arg1 25 lastarg!
```

控制台输出：
```c
argv[0]=./testargs
argv[1]=arg1
argv[2]=25
argv[3]=lastarg!
```

需要数字参数的程序可以使用stdlib.h中的函数将字符串参数转换为数字。

编译过程中编译器的整体操作：
 1. 通过包含引用库和扩大宏定义来预处理文件。
 2. 忽略所有的不必要信息，如注释。
 3. 将高级代码转换为用二进制表示的本地处理器的简单指令，即机器语言。
 4. 将所有的指令转换成一个可由计算机读取和执行的简单二进制可执行文件。

每种机器语言特定于一种给定的机器，因此程序必须专门为其将要运行的系统进行编译。

## Java程序编译和解释

以Java为例，`Hello.java`编译成.class字节码：
```shell
javac Hello.java
```
解释执行`Hello.class`：
```shell
java Hello
```

Java编译的补充知识：
- [命令行下的Java包结构编译与执行](https://blankspace.blog.csdn.net/article/details/104552096)
- [命令行下的Java模块化建构、编译与执行](https://blankspace.blog.csdn.net/article/details/104555618)

## Python程序解释

以Python为例，执行`hello.py`脚本：
```shell
python hello.py
```


