---
title: C语言指针获取数组最后一个元素
date: 2020-03-06 16:30:03
summary: 本文分享使用C语言指针获取数组的最后一个数的方法。
tags:
- C语言
categories:
- 开发技术
---

# 问题描述

使用指向数组的指针，得到数组的最后一个数。

# 程序设计

对于`int m = 1;`：
- `*m`由于m不是指针变量，所以不存在。
- `&m`是指向m的地址。
- `*&m`是指地址为`&m`的内存中存放的值，也就是m的值。

C语言的数组地址为其首元地址，每个元素地址都是其首地址。
比如一个长度为4的int数组，首元地址600000，第二个元素是600004，第三个元素是600008，最后一个元素是600012，数组地址范围600000 ~ 600015，长16字节。
`&a+1`表示了在数组首地址加上数组总长，上例则为600016。
同理，如果是`&a+2`则表示600032，`&+3`则为600048，……

`int *p = (int*)(&a + 1);`上面的语句定义了一个int类型的指针，指向的位置是`&a+1`，上例的600016。
“相当于”是一个新的数组，此时600016成了首元，p-1则是倒着取一个元素，地址600012，p-2则是600008，……
*(p-1)对p-1地址的数据取出，得到的正是600012存的元素，即第四个元素，也是最后一个元素。

```c
#include <stdio.h>
int main()
{
    int a[8] = {1, 2, 4, 8, 16, 32, 64, 128};
    int *p = (int*)(&a + 1);
    printf("%d\n", a);
    printf("%d\n", &a[0]);
    printf("%d\n", *a);
    printf("%d\n", &a);
    printf("%d\n", (&a+1));
    printf("%d\n", (&a+2));
    printf("%d\n", (&a+3));
    printf("%d\n", p);
    printf("%d\n", (p - 1));
    printf("%d\n", (p - 2));
    printf("%d\n", *p);
    printf("%d\n", *(p - 1));
    return 0;
}
```

执行结果：
```
6422000
6422000
1
6422000
6422032
6422064
6422096
6422032
6422028
6422024
7869392
128
```

# 实现代码

```c
#include <stdio.h>

int main()
{
    int a[8] = {1, 2, 4, 8, 16, 32, 64, 128};
    int *p = (int*)(&a + 1);
    printf("%d\n", *(p - 1));
    return 0;
}
```

输出结果是：`128`。

这段代码的功能为输出数组a中的最后一个元素。

首先定义了一个包含8个元素的整型数组a，并将其初始化为{1, 2, 4, 8, 16, 32, 64, 128}，然后定义一个指向整型的指针p。接着将&a+1的值赋给指针p，即&a的地址加上一个int类型所占的字节数（8字节），此时p指向的是a数组末尾的下一个内存单元的地址。因此，*(p-1)就等价于a[7]，即数组a的最后一个元素128。最后通过printf()函数将其输出到终端。

需要注意的是，这段代码非常危险，因为它违反了C语言的指针访问规则。具体来说，对一个数组使用取地址符&时，得到的结果是该数组的第一个元素的地址。因此(&a+1)实际上是一个指向a数组末尾下一个位置的指针，而不是a数组的末尾。这里使用强制类型转换把这个指针转换成了一个整型指针p，导致程序在执行*(p-1)时发生了越界访问。
