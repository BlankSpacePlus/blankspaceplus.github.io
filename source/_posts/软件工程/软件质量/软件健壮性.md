---
title: 软件健壮性
date: 2023-02-11 14:42:59
summary: 本文分享软件健壮性的相关内容。
tags:
- 软件质量
- 软件工程
categories:
- 软件工程
---

# 软件健壮性

计算机科学中，健壮性(Robustness)，也称鲁棒性，是指一个计算机系统在执行过程中处理错误，以及算法在遭遇输入、运算等异常时维持正常运行的能力。

健壮性与容错有关，即发生故障时系统还能继续运行的能力。容错的目的是：发生故障时，系统的运行水平可能有所下降，但是依然可用，不会完全失败。

做个简单的比方：
```java
Scanner scan = new Scanner(System.in);
int a = scan.nextInt();
```

上面的代码在遇到输入是非int数据时会报错，系统崩溃。

而如果按照如下方法改写：
```java
Scanner scan = new Scanner(System.in);
String a = scan.next();
if (a.matches("\\d+")) {
    int b = Integer.parseInt(a);
}
```
或者：
```java
Scanner scan = new Scanner(System.in);
String a = scan.next();
try {
    int b = Integer.parseInt(a);
} catch (NumberFormatException e) {
    //异常处理code
}
```

如此，系统在遇到非法输入时起码保证了不崩溃。我们不能假设用户总是聪明的和守规则的，软件在设计的时候就就应该提供充足的容错。

# 混沌测试

混沌工程和弹性测试正是针对健壮性展开的，这是一种面向失败设计的思想。这种思想背后的逻辑是，工程师们普遍承认任何事情都可能出错，因此应用程序和基础设施必须能够容错。

混沌测试试图通过一些混乱工具人为地破坏基础设施，甚至人为地引入各种故障，测试系统的容错能力。想要开展混沌测试，必须要有先进的基础设施和运维技能，有强大的设计、执行、实验能力，以及可用来手动排除故障场景的资源、经验。

混沌工程本质上是一个在分布式系统上进行实践的理论，目的是建立处理生产环境复杂情况能力的信心，而不是为了破坏生产环境。为了解决分布式系统中大规模的不确定性问题，混沌工程可以作为发现系统性弱点的实验工具。

混沌实验的步骤：
1. 将稳定状态定义为系统的可量化指标，表示正常的行为。
2. 假设在对照组和实验组中，这种稳定状态会继续存在。
3. 引入反映真实世界的变量，例如崩溃的服务器、发生故障的硬盘驱动器、断开的网络连接等。
4. 试着寻找对照组和实验组之间的稳定状态的差异，来反驳这一假设。

破坏稳定状态越难，工程师们对系统稳定性的信心就越强。如果在混沌测试中发现了系统的弱点，就应该在大规模波及系统前修复它。

考虑到在生产环境中制造问题开展混沌测试可能风险太大，工程师可以在预发布环境中尝试混沌测试，根据测试结果进行必要的完善和修复，然后将程序逐步部署到生产环境。

# 常见容错机制

经过长期的工程实践，工程师们总结出了一些比较常见的容错机制。
- fail-over (失败自动切换)：当出现失败，重试其它服务器，通常用于读操作（推荐使用），重试会带来更长延迟。
- fail-fast (快速失败)：只发起一次调用，失败立即报错,通常用于非幂等性的写操作。如果有机器正在重启，可能会出现调用失败。
- fail-safe (失败安全)：出现异常时，直接忽略，通常用于写入审计日志等操作。调用信息丢失。可用于生产环境Monitor。
- fail-back (失败自动恢复)：后台记录失败请求，定时重发。通常用于消息通知操作不可靠，重启丢失。可用于生产环境Registry。
- forking：并行调用多个服务器，只要一个成功即返回，通常用于实时性要求较高的读操作，需要浪费更多服务资源。
- broadcast：广播调用，所有提供逐个调用，任意一台报错则报错。通常用于更新提供方本地状态速度慢，任意一台报错则报错。
