---
title: 函数与指针
date: 2023-03-26 21:21:29
summary: 本文讨论函数与指针的相关内容。
tags:
- 程序设计
categories:
- 程序设计
---

# 函数与指针

函数与指针在C++中有着密切的关联。指针可以用来传递函数的参数或返回函数的值，同时函数指针也可以作为参数传递给其他函数或作为返回值返回。

## 指针作为函数参数

指针可以用来传递函数的参数，从而实现在函数内部对外部变量的修改。

```cpp
void swap(int* a, int* b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

int main() {
    int x = 1, y = 2;
    swap(&x, &y);
    cout << "x = " << x << ", y = " << y << endl; // 输出 x = 2, y = 1
    return 0;
}
```

在上面的例子中，swap函数接受两个指向整型变量的指针作为参数，通过指针交换了变量的值。在调用swap函数时，需要将变量的地址传递给函数。

## 指针作为函数返回值

指针可以作为函数的返回值返回，从而返回一个指向某种数据类型的指针。

```cpp
int* createIntArray(int size) {
    int* arr = new int[size];
    for (int i = 0; i < size; i++) {
        arr[i] = i + 1;
    }
    return arr;
}

int main() {
    int* arr = createIntArray(5);
    for (int i = 0; i < 5; i++) {
        cout << arr[i] << " ";
    }
    cout << endl; // 输出 1 2 3 4 5
    delete[] arr;
    return 0;
}
```

在上面的例子中，createIntArray函数返回一个指向整型数组的指针。在函数内部，使用new运算符在堆内存中动态分配了一个整型数组，并对数组进行初始化。在函数调用结束后，返回指向数组的指针，外部程序通过该指针访问和操作数组。在最后释放动态分配的内存。

## 函数指针

函数指针指向的是函数的地址，可以通过函数指针来调用函数，从而实现动态调用函数的目的。可以将函数指针作为参数传递给其他函数或作为返回值返回。

```cpp
void printInt(int x) {
    cout << x << endl;
}

void forEach(int* arr, int size, void (*action)(int)) {
    for (int i = 0; i < size; i++) {
        action(arr[i]);
    }
}

int main() {
    int arr[] = {1, 2, 3, 4, 5};
    forEach(arr, 5, printInt); // 输出 1 2 3 4 5
    return 0;
}
```

在上面的例子中，forEach函数接受一个整型数组、数组长度和一个函数指针作为参数。函数指针的类型为void (*)(int)，表示指向一个参数为整型、返回值为void的函数。在函数内部，使用函数指针，遍历整型数组，对每个元素调用传入的函数指针。在主函数中，将printInt函数的地址作为参数传递给forEach函数，从而实现遍历数组并打印每个元素的效果。

总之，C++中函数指针是一种强大的工具，可以实现动态调用函数和实现回调等功能。指针与函数密切相关，不仅可以传递指针参数，还可以使用指针返回函数值，或将函数指针作为参数传递给其他函数或作为返回值返回。

# 函数指针与回调函数

函数指针是一个指向函数的指针变量，它可以存储一个函数的地址，使得我们可以通过该指针调用函数。函数指针可以作为参数传递给其他函数，也可以作为其他函数的返回值。

回调函数是一个通过函数指针调用的函数，它通常作为参数传递给另一个函数，当另一个函数完成某个操作时，它将调用回调函数来执行一些额外的逻辑。回调函数的作用类似于事件处理程序，可以用于实现异步操作、事件驱动程序等。

在C语言中，函数指针和回调函数通常被用于实现一些高级的编程技术，例如回调函数用于实现事件处理程序，函数指针用于实现多态性等。

下面是一个使用函数指针和回调函数的简单示例，代码使用C语言实现：

```cpp
#include <stdio.h>

// 回调函数
void callback(int arg) {
    printf("callback with arg=%d\n", arg);
}

// 函数指针作为参数
void invoke_callback(void (*cb)(int), int arg) {
    cb(arg);
}

int main() {
    // 定义一个函数指针变量
    void (*func_ptr)(int);
    // 将函数指针指向回调函数
    func_ptr = callback;
    // 调用函数指针
    func_ptr(123);
    // 将函数指针作为参数传递给另一个函数
    invoke_callback(func_ptr, 456);
    return 0;
}
```

在上面的代码中，我们定义了一个回调函数callback和一个使用函数指针作为参数的函数invoke_callback。在主函数中，我们定义了一个函数指针变量func_ptr，将其指向回调函数，并分别通过函数指针和函数参数调用了回调函数。
