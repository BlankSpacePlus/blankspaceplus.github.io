---
title: 位移运算符
date: 2020-02-17 23:07:58
summary: 本文揭秘Java位移运算符<<<、>>>的用法。
mathjax: true
tags:
- 程序设计
categories:
- 程序设计
---

# 位移运算符

Java中的位移运算符包括左移运算符`<<`、右移运算符`>>`和无符号右移运算符`>>>`。它们都是用来对二进制数进行移位操作的，可以将二进制数的每一位向左或向右移动指定的位数。这里分别举例介绍它们的用法和应用。
- <<表示算术左移，<<n相当于$×2^n$。
- >>表示算术右移，>>n相当于$÷2^n$，即$×2^{-n}$。
- >>>表示逻辑右移，>>>n相当于$÷2^n$，即$×2^{-n}$。

没有<<<这种运算符，因为左移都是补零，算术左移与逻辑左移等价。

温馨提示：
- >>和\>>>有别。>>表示的算术右移，按照二进制符号位来，是0补0，是1补1；>>>表示的逻辑右移，高位补0。
- 对于byte、short，其数据范围小，很容易溢出。
- 这些运算符对BigInteger对象不适用。

## 左移运算符<<

左移运算符<<将一个数的二进制码向左移动指定的位数，右边空出的位用0补齐。左移操作相当于将一个数乘以2的n次方（n为左移的位数）。

例如：`a << n` 等价于 `a * (2 ^ n)`

左移运算符的一个常见应用是将整数乘以2的n次方。例如，将整数3左移2位，得到的结果为12（3 << 2 = 12），相当于将3乘以2的2次方。

另外，左移运算符还可以用来创建掩码（mask），掩码是一种用于数据处理的二进制模板。左移运算符可以用来将一个整数的二进制码左移指定的位数，然后将结果与一个掩码进行按位与操作，得到一个指定的二进制码位序列。这个位序列可以用来提取或者屏蔽一个数的指定位，从而实现对数据的处理和处理结果的检查。

## 右移运算符>>

右移运算符>>将一个数的二进制码向右移动指定的位数，左边空出的位用符号位补齐，即正数用0补齐，负数用1补齐。右移操作相当于将一个数除以2的n次方（n为右移的位数）。

例如：`a >> n` 等价于 `a / (2 ^ n)`

右移运算符的一个常见应用是将整数除以2的n次方。例如，将整数16右移2位，得到的结果为4（16 >> 2 = 4），相当于将16除以2的2次方。

另外，右移运算符还可以用来对负数进行二进制补码运算。当一个负数进行右移操作时，左边会用符号位填充，这相当于将负数的二进制码右移指定的位数，并保持原来的符号位不变。这种特性可以用来对负数进行处理和检查。

## 无符号右移运算符>>>

无符号右移运算符>>>将一个数的二进制码向右移动指定的位数，左边空出的位用0补齐。无符号右移操作相当于将一个无符号数除以2的n次方（n为右移的位数）。

许多编程语言不支持`>>>`，但支持`<<`和`>>`。

例如：`a >>> n` 等价于 `a / (2 ^ n)`

无符号右移运算符（>>>）的一个常见应用是获取无符号整数的二进制位。在一些场景下，需要对无符号整数的每一位进行操作，比如校验和、哈希计算等。此时，可以通过无符号右移运算符来获取无符号整数的二进制位，再进行相应的操作。由于无符号右移运算符补位方式为0，因此不会影响到结果的准确性。

例如，假设需要计算一个无符号整数的校验和，可以先将其转换为二进制字符串，然后对每一位进行累加，并取模得到最终的校验和。以下是一个示例代码：

```java
public static int calculateChecksum(int n) {
    int sum = 0;
    String binaryString = Integer.toBinaryString(n);
    for (int i = 0; i < binaryString.length(); i++) {
        int bit = Integer.parseInt(String.valueOf(binaryString.charAt(i)));
        sum += bit;
    }
    return sum % 256;
}
```

在上述代码中，我们先将整数n转换为二进制字符串，然后对每一位进行累加，最后取模得到校验和。但是，这种方法对于大型无符号整数的计算会非常耗时，因为需要将每一位都转换为字符再进行解析。此时，可以通过无符号右移运算符来直接获取二进制位，从而提高计算效率。以下是优化后的示例代码：

```java
public static int calculateChecksum(int n) {
    int sum = 0;
    for (int i = 0; i < 32; i++) {
        int bit = (n >>> i) & 1;
        sum += bit;
    }
    return sum % 256;
}
```

在上述代码中，我们使用了无符号右移运算符（>>>）来获取整数n的二进制位，然后进行累加。这种方法无需将整数转换为字符串再进行解析，因此可以大大提高计算效率。

# 补充说明

当int类型的值左移/右移位数大于等于32位时，会先对32求余（%）后再进行左移/右移操作。当 long类型的值左移/右移位数大于等于64位时，也会先对64求余（%）后再进行左移/右移操作。
