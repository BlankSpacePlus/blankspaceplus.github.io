---
title: 日期和时间
date: 2023-02-04 01:01:01
summary: 本文分享程序设计中日期和时间的相关内容，以Java、C/C++、Python为例。
tags:
- 程序设计
categories:
- 程序设计
---

# Java日期和时间

## java.util.Date

java.util.Date与java.sql.Date不同。java.util.Date是一个比较原始的类，机制比较落后，不推荐使用。

```java
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;

public class DateDemo {

    public static void main(String[] args) {
        Date date = new Date();
        // 日期字符串格式
        SimpleDateFormat ft = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
        System.out.println("当前时间为: " + ft.format(date));
        // 日期属性
        // b的使用，月份简称
        String str = String.format(Locale.US, "英文月份简称：%tb", date);
        System.out.println(str);
        System.out.printf("本地月份简称：%tb%n", date);
        // B的使用，月份全称
        str = String.format(Locale.US, "英文月份全称：%tB", date);
        System.out.println(str);
        System.out.printf("本地月份全称：%tB%n", date);
        // a的使用，星期简称
        str = String.format(Locale.US, "英文星期的简称：%ta", date);
        System.out.println(str);
        // A的使用，星期全称
        System.out.printf("本地星期的简称：%tA%n", date);
        // C的使用，年前两位
        System.out.printf("年的前两位数字（不足两位前面补0）：%tC%n", date);
        // y的使用，年后两位
        System.out.printf("年的后两位数字（不足两位前面补0）：%ty%n", date);
        // j的使用，一年的天数
        System.out.printf("一年中的天数（即年的第几天）：%tj%n", date);
        // m的使用，月份
        System.out.printf("两位数字的月份（不足两位前面补0）：%tm%n", date);
        // d的使用，日（二位，不够补零）
        System.out.printf("两位数字的日（不足两位前面补0）：%td%n", date);
        // e的使用，日（一位不补零）
        System.out.printf("月份的日（前面不补0）：%te", date);
        // 将日期字符串解析为时间
        String input = args.length == 0 ? "2011-11-11 11:11:11" : args[0];
        System.out.print(input + " Parses as ");
        Date t;
        try {
            t = ft.parse(input);
            System.out.println(t);
        } catch (ParseException e) {
            e.printStackTrace();
        }
    }

}
```

## java.util.Calendar

java.util.Calendar是一个抽象类，提供了日历类的模板，必须通过`Calendar.getInstance()`获取实例。

推荐阅读：[抽象类和模板模式](https://blankspace.blog.csdn.net/article/details/123172755)

java.util.Calendar.MONTH比较特殊，月份数值从0开始，而不是1。

```java
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;

public class CalendarDemo {

    public static void main(String[] args) {
        // 规定输出日期格式
        SimpleDateFormat ft = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
        // 创建Calendar对象
        Calendar c1 = Calendar.getInstance();
        System.out.println(ft.format(c1.getTime()));
        // 获得年
        int year = c1.get(Calendar.YEAR);
        System.out.println(year);
        // 获得月，1月为0
        int month = c1.get(Calendar.MONTH) + 1;
        System.out.println(month);
        // 获得日
        int day = c1.get(Calendar.DATE);
        System.out.println(day);
        // 获得时
        int hour = c1.get(Calendar.HOUR_OF_DAY);
        System.out.println(hour);
        // 获得分
        int minute = c1.get(Calendar.MINUTE);
        System.out.println(minute);
        // 获得秒
        int second = c1.get(Calendar.SECOND);
        System.out.println(second);
        // 获得星期几（注意（这个与Date类是不同的）：1代表星期日、2代表星期1、3代表星期二，以此类推）
        int weekday = c1.get(Calendar.DAY_OF_WEEK);
        System.out.println(weekday);
        // 通过Calendar生成Date
        Date date = c1.getTime();
        // 根据date调整Calendar
        Calendar c2 = Calendar.getInstance();
        c2.setTime(date);
        System.out.println(ft.format(c2.getTime()));
        // 手动设置时间
        c2.set(2022, Calendar.AUGUST, 31);
        System.out.println(ft.format(c2.getTime()));
        // 测试add()功能
        c2.add(Calendar.MONTH, 6);
        System.out.println(ft.format(c2.getTime()));
        // 测试roll()功能
        c2.set(2022, Calendar.AUGUST, 31);
        c2.roll(Calendar.MONTH, 6);
        System.out.println(ft.format(c2.getTime()));
        // 设置MONTH为13
        c2.set(Calendar.MONTH, 13);
        System.out.println(ft.format(c2.getTime()));
        // 关闭容错性
        c2.setLenient(false);
        try {
            c2.set(Calendar.MONTH, 13);
            System.out.println(ft.format(c2.getTime()));
        } catch (IllegalArgumentException e) {
            System.out.println("增加月份错误");
        }
        // 开启容错性
        c2.setLenient(true);
    }

}
```

## java.time

### java.time.Clock

java.time.Clock用于获取指定时区的当前日期、时间，可以取代`java.lang.System.currentTimeMillis()`。

```java
import java.time.Clock;
import java.time.ZoneId;

/**
 * Clock用于获取指定时区的当前日期和时间
 */
public class ClockDemo {

    public static void main(String[] args) {
        ZoneId zoneId = ZoneId.systemDefault();
        System.out.println("ZoneId: " + zoneId);
        Clock clock = Clock.system(zoneId);
        System.out.println(clock.instant());
        System.out.println(clock.millis());
        System.out.println(System.currentTimeMillis());
    }

}
```

### java.time.Duration

java.time.Duration代表持续时间，可以非常方便地获取一段时间。

```java
import java.time.Clock;
import java.time.Duration;

/**
 * Duration表示持续时间，代表一段时间
 */
public class DurationDemo {

    public static void main(String[] args) {
        Duration duration = Duration.ofSeconds(6000);
        System.out.println(duration.toMinutes());
        System.out.println(duration.toHours());
        System.out.println(duration.toDays());
        Clock clock = Clock.offset(Clock.systemUTC(), duration);
        System.out.println(clock.instant());
    }

}
```

### java.time.Instant

java.time.Instant代表一个具体的时刻，可以精确到纳秒，可以方便地对时刻进行加减法(通过方法而不是运算符)。

```java
import java.time.Duration;
import java.time.Instant;

/**
 * Instant代表某一个具体的时刻，可以精确到纳秒
 */
public class InstantDemo {

    public static void main(String[] args) {
        Instant instant = Instant.now();
        System.out.println(instant);
        instant = instant.plusSeconds(6000);
        System.out.println(instant);
        instant = Instant.parse("2022-08-01T09:08:07.342Z");
        System.out.println(instant);
        instant = instant.plus(Duration.ofHours(3).plusMinutes(20));
        System.out.println(instant);
        instant = instant.minus(Duration.ofDays(4));
        System.out.println(instant);
    }

}
```

### java.time.LocalDate

java.time.LocalDate代表不带时区的日期。

```java
import java.time.LocalDate;
import java.time.Month;

/**
 * LocalDate表示不带时区的日期
 */
public class LocalDateDemo {

    public static void main(String[] args) {
        LocalDate localDate = LocalDate.now();
        System.out.println(localDate);
        // 获取2021年第211天
        localDate = LocalDate.ofYearDay(2021, 211);
        System.out.println(localDate);
        // 2022-08-02
        localDate = LocalDate.of(2022, Month.AUGUST, 2);
        System.out.println(localDate);
    }

}
```

### java.time.LocalTime

java.time.LocalTime代表不带时区的时间。

```java
import java.time.LocalTime;

/**
 * LocalTime代表不带时区的时间
 */
public class LocalTimeDemo {

    public static void main(String[] args) {
        LocalTime localTime = LocalTime.now();
        System.out.println(localTime);
        localTime = LocalTime.of(23, 23);
        System.out.println(localTime);
        localTime = LocalTime.ofSecondOfDay(66666);
        System.out.println(localTime);
    }

}
```

### java.time.LocalDateTime

java.time.LocalDateTime代表了不带时区的日期和时间，而java.time.ZonedDateTime代表一个时区化的日期和时间。

```java
import java.time.LocalDateTime;

/**
 * LocalDateTime代表不带时区的日期时间
 */
public class LocalDateTimeDemo {

    public static void main(String[] args) {
        LocalDateTime localDateTime = LocalDateTime.now();
        System.out.println(localDateTime);
        localDateTime = localDateTime.plusDays(3).plusHours(25).plusMinutes(33);
        System.out.println(localDateTime);
    }

}
```

### java.time.Year

java.time.Year、java.time.Month、java.time.Day、java.time.YearMonth、java.time.MonthDay、java.time.DayOfWeek等类的含义非常明显，不啰嗦。

```java
import java.time.Month;
import java.time.MonthDay;
import java.time.Year;
import java.time.YearMonth;

/**
 * Year代表年
 * YearMonth代表年月
 * MonthDay代表月日
 * Month是一个枚举类
 * DayOfWeek也是枚举类
 */
public class YearMonthDayDemo {

    public static void main(String[] args) {
        Year year = Year.now();
        System.out.println(year);
        year = year.plusYears(3);
        System.out.println(year);
        YearMonth yearMonth = year.atMonth(Month.AUGUST);
        System.out.println(yearMonth);
        yearMonth = yearMonth.minusYears(2).plusMonths(1);
        System.out.println(yearMonth);
        MonthDay monthDay = MonthDay.now();
        System.out.println(monthDay);
        monthDay = monthDay.with(Month.APRIL).withDayOfMonth(22);
        System.out.println(monthDay);
    }

}
```

### java.time.ZoneId

java.time.ZoneId代表时区。

```java
import java.time.Instant;
import java.time.ZoneId;
import java.time.ZoneOffset;
import java.util.List;
import java.util.stream.Collectors;

public class ZoneOffsetDemo {

    public static void main(String[] args) {
        ZoneOffset plusTwo = ZoneOffset.ofHours(2);
        List<String> zonesWithPlusTwo =
                ZoneId.getAvailableZoneIds()
                        .stream()
                        .filter(zoneId -> ZoneId.of(zoneId)
                                .getRules()
                                .getOffset(Instant.now())
                                .equals(plusTwo))
                        .sorted()
                        .collect(Collectors.toList());
        zonesWithPlusTwo.forEach(System.out::println);
    }

}
```

## 注意事项

1. `yyyy-MM-dd HH:mm:ss`是正确用法，不要使用`YYYY-MM-dd HH:mm:ss`，区别详见[StackOverflow](https://stackoverflow.com/questions/26431882/difference-between-year-of-era-and-week-based-year)
2. C#的DateTime/TimeSpan是immutable的，而Java的Date/Calendar是mutable的，为了避免set操作，正确使用方法有以下三种：
    - 使用long，配合java.util.concurrent.TimeUnit的转换方法和org.apache.commons.lang3.time.DateUtils进行日期计算
    - 用joda
    - 用jdk8+的新的JSR310 Date/Time API（java.time.*）
3. 计算时间差的话，用System.currentTimeMillis()可能存在一定误差，还是用System.nanoTime()比较好（currentTimeMillis的注释如此写的，很多操作系统的这个时间误差会在10ms左右），甚至使用System.currentTimeMillis()计算时间差可能出现负数
4. DBA存时间建议使用bigint，理由是：
    - 避免因为时区转换等问题，造成困扰
    - 避免夏令时等因素影响
    - 尽量输出到端上进行时间渲染，同样避免时区问题导致bug

# C/C++日期和时间

头文件`<time.h>`/`<ctime>`：
```c
#include <time.h>
```

结构体tm的定义：

```c
struct tm {
    int tm_sec;     // 秒，正常范围从 0 到 59，但允许至 61
    int tm_min;     // 分，范围从 0 到 59
    int tm_hour;    // 小时，范围从 0 到 23
    int tm_mday;  // 一月中的第几天，范围从 1 到 31
    int tm_mon;    // 月，范围从 0 到 11
    int tm_year;    // 自 1900 年起的年数
    int tm_wday;   // 一周中的第几天，范围从 0 到 6，从星期日算起
    int tm_yday;    // 一年中的第几天，范围从 0 到 365，从 1 月 1 日算起
    int tm_isdst;    // 夏令时
};
```

参考代码：
```c
#include <stdio.h>
#include <time.h>

#define BST (+1)
#define CCT (+8)

int main() {
    struct tm t;
    t.tm_sec = 10;
    t.tm_min = 10;
    t.tm_hour = 6;
    t.tm_mday = 25;
    t.tm_mon = 2;
    t.tm_year = 89;
    t.tm_wday = 6;
    // 返回一个指向字符串的指针，表示结构timeptr的日期和时间
    puts(asctime(&t));

    time_t currentTime;
    time(&currentTime);
    // 返回一个字符串，该字符串包含了可读格式的日期和时间信息
    printf("当前时间 = %s\n", ctime(&currentTime));

    time_t rawTime;
    struct tm *info;
    time(&rawTime);
    // 获取GMT时间，timer的值被分解为tm结构，并用协调世界时(UTC)也被称为格林尼治标准时间(GMT)表示
    info = gmtime(&rawTime);
    printf("当前的世界时钟：\n");
    printf("伦敦：%2d:%02d\n", (info->tm_hour+BST)%24, info->tm_min);
    printf("中国：%2d:%02d\n\n", (info->tm_hour+CCT)%24, info->tm_min);

    time_t seconds;
    // 计算当前日历时间，并把它编码成time_t格式
    seconds = time(NULL);
    printf("自1970-01-01起的小时数 = %lld\n", seconds/3600);

    return 0;
}
```

输出结果：
```
Sat Mar 25 06:10:10 1989

当前时间 = Sat Feb 04 00:12:43 2023

当前的世界时钟：
伦敦：17:12
中国： 0:12

自1970-01-01起的小时数 = 465400
```

# Python日期和时间

暂未总结，推荐阅读：[菜鸟教程 Python3 日期和时间](https://www.runoob.com/python3/python3-date-time.html)
