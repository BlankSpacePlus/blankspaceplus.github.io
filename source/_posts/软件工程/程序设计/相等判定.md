---
title: 相等判定
date: 2023-03-21 22:50:27
summary: 本文分享程序设计常常涉及的相等性判定问题，以Java和Python为例。
tags:
- 程序设计
categories:
- 程序设计
---

# Java相等判定

在Java中，`==`是用来判断两个对象的引用是否指向同一块内存空间的，也就是比较两个对象的地址是否相同。而`equals()`方法是用来判断两个对象在逻辑上是否相等，也就是比较它们的内容是否相同。

以下面的代码段为例：
```java
String str1 = "hello";
String str2 = new String("hello");
String str3 = "hello";
```

上述代码中，str1和str2分别是两个不同的String对象，它们的值都是"hello"。而str3和str1是同一个String对象的两个引用。

接下来我们使用`==`和`equals()`来比较这些字符串：
```java
System.out.println(str1 == str2);      // false
System.out.println(str1 == str3);      // true
System.out.println(str1.equals(str2)); // true
System.out.println(str1.equals(str3)); // true
```

从输出结果可以看出，str1和str2的引用地址不同，所以使用`==`比较它们的结果为false。而str1和str3的引用地址相同，所以使用`==`比较它们的结果为true。同时，由于这三个字符串的内容都是"hello"，所以使用`equals()`比较它们的结果都为true。

因此，一般情况下，如果我们想比较两个对象的内容是否相等，应该使用`equals()`方法。而如果我们需要判断两个对象是否是同一个对象（也就是两个对象的引用是否相同），则应该使用`==`运算符。

## equals()和hashCode()

在Java中，equals()和hashCode()是两个重要的方法，它们通常是成对出现的，因为它们都与对象的相等性判定有关。

在Java中，如果两个对象通过equals()方法比较返回true，则它们的hashCode()方法应该返回相同的值。反之，如果两个对象的hashCode()返回值不同，那么它们通过equals()比较返回值应该为false。

hashCode()方法返回一个对象的哈希码，这个哈希码是由对象的内部状态计算出来的。equals()方法则用来比较两个对象的内部状态是否相等，也就是判断它们是否在逻辑上相等。

当我们在自定义类中重写equals()方法时，通常也需要重写hashCode()方法，以保证它们的一致性。

下面是一个简单的例子，展示了如何重写equals()和hashCode()方法：
```java
public class Person {

    private String name;

    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public boolean equals(Object obj) {
        if (obj == this) {
            return true;
        }
        if (!(obj instanceof Person)) {
            return false;
        }
        Person other = (Person) obj;
        return this.name.equals(other.name) && this.age == other.age;
    }

    public int hashCode() {
        int result = 17;
        result = 31 * result + name.hashCode();
        result = 31 * result + age;
        return result;
    }

}
```

在这个例子中，我们重写了equals()和hashCode()方法，以实现自定义的相等性比较。在hashCode()方法中，我们使用了经典的HashCode算法，对对象的属性进行哈希计算。在equals()方法中，我们首先判断两个对象是否是同一个对象或者是否属于同一个类，然后再比较它们的属性是否相等。

需要注意的是，在重写equals()和hashCode()方法时，需要遵循以下规则：
- 如果两个对象相等，那么它们的hashCode()方法应该返回相同的值。
- 如果两个对象的hashCode()方法返回值相同，它们不一定相等，需要通过equals()方法再次比较。
- hashCode()方法的返回值应该尽可能地分布均匀，这有助于提高HashMap的性能。

# Python相等判定

在Python中，`is`和`==`都是用来判断对象相等的，但它们的用法和意义是不同的。

is用来比较两个对象的身份标识是否相同，也就是比较它们是否是同一个对象，也就是比较两个引用是否代表了内存中同一个地址。而==用来比较两个对象的值是否相等，也就是比较它们的内容是否相同，调用了对象的`__eq__()`方法。

下面我们通过一个例子来说明这两种方法的区别：
```python
list1 = [1, 2, 3]
list2 = [1, 2, 3]
list3 = list1
```

上述代码中，list1和list2是两个不同的列表，它们的元素相同。而list3和list1是同一个列表的两个引用。

接下来我们使用is和==来比较这些列表：

```python
print(list1 is list2)      # False
print(list1 is list3)      # True
print(list1 == list2)      # True
```

从输出结果可以看出，list1和list2的身份标识不同，所以使用is比较它们的结果为False。而list1和list3的身份标识相同，所以使用is比较它们的结果为True。同时，由于这三个列表的元素都相同，所以使用`==`比较它们的结果都为True。

因此，在Python中，一般情况下，如果我们想比较两个对象是否是同一个对象，应该使用is关键字。而如果我们需要判断两个对象的值是否相等，则应该使用`==`运算符。需要注意的是，在Python中，字符串、数字、元组等不可变对象的值一旦确定就不会改变，它们的身份标识和值都是确定的，因此在比较这些对象时，`is`和`==`的结果是一致的。而对于列表、字典等可变对象，它们的身份标识和值都可以改变，因此在比较这些对象时，`is`和`==`的结果可能不同。
