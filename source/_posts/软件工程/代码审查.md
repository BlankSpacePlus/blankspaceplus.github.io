---
title: 代码审查
date: 2023-02-10 17:36:39
summary: 本文分享代码审查的相关内容。
tags:
- 软件质量
- 软件工程
categories:
- 软件工程
---

# 代码审查

代码审查是至少由一名开发人员来审查另外一名开发人员所编写的代码的过程。

> Code review, where code contributions of a software practitioner are evaluated by other members of the team, is a common practice in software teams. This practice brings significant advantages such as improved code quality and knowledge sharing. During code review, reviewers may identify functional issues with the code, suggest changes to the design, check for adherence to coding conventions, suggest alternate implementations, or simply provide praise. Despite its popularity, a common complaint is the cost of performing code review, in particular the time it takes. To this end, tools have been proposed that automatically provide reviewers the information they need, enable effective collaboration, and detect defects using static analysis. Static analysis tools would typically be run prior to the code review so reviewers can focus on identifying more complex potential issues during code review. Despite the wide availability of such tools, developers have reported low adoption of these tools due to false positives and other barriers and complaints are still being made on the cost of code review.

摘自：[Concerns identified in code review: A fine-grained, faceted classification](https://www.sciencedirect.com/science/article/pii/S0950584922001653)

推荐阅读：[Google Code Review Developer Guide](https://google.github.io/eng-practices/review/)

# 代码审查关注的问题

## 可理解性问题

编写更容易理解的代码，不仅可以帮助团队其他成员开发，还能帮助自己回顾功能或排查BUG。除非涉及对性能要求较高的业务，否则牺牲部分性能保障代码的可理解性是非常重要的。

代码审查对可理解性问题的关注点：
- 使用解决方案或问题领域的名称。
- 使用含义显而易见的名称。
- 尽量减少类和成员的可访问性(封装)。
- 尽量减少类和方法的规模。
- 尽量减少局部变量的作用域。
- 单个逻辑组件(包/模块/服务)要遵循DRY原则(Don't Repeat Yourself)。
- 用代码来解释代码。
- 使用异常而不是难懂的错误码，尽量不返回null。

## 语言规范问题

每种编程语言都有自身约定俗成的规范被开发人员所接受采纳，例如[Google Checkstyle](https://checkstyle.sourceforge.io/google_style.html)和[Sun Checkstyle](https://checkstyle.sourceforge.io/sun_style.html)。

代码审查对语言规范问题的关注点：
- 对于可恢复条件采取CheckedException，对编程错误采取RuntimeException。推荐阅读：[程序错误与异常处理](https://blankspace.blog.csdn.net/article/details/123164216)
- 检查参数的有效性，使其尽可能接近规范要求或用户输入。
- 标明哪些参数可以为null。
- 公共类中，尽可能通过getter和setter方法操作，而不是直接操作公共属性字段(封装)。推荐阅读：[封装、继承、多态](https://blankspace.blog.csdn.net/article/details/114697596)
- 通过接口来引用对象(面向接口编程)。推荐阅读：[接口](https://blankspace.blog.csdn.net/article/details/105441651)
- 通过枚举来代替int常量(这是枚举存在的意义)。推荐阅读：[枚举](https://blankspace.blog.csdn.net/article/details/128921333)
- 通过标记接口(MarkerInterface)来定义类型。说明：MarkerInterface是没有包含方法声明的接口，而只是指明一个类实现了具有某种属性的接口，例如java.io.Serializable。
- 同步对共享变量的访问。推荐阅读：[操作系统的进程管理](https://blankspace.blog.csdn.net/article/details/128746107)
- 将关键数据记录到日志中。

## 安全问题

程序必须保证安全性，否则会引来一系列问题。

代码审查对安全问题的关注点：
- 检查输入数据的大小和范围，始终保持供给数据存储、中间件或第三方系统的任何输入数据都是安全的。
- 日志中不要记录高敏感信息，要做好高敏感信息治理。
- 异常中不要记录敏感信息，例如文件路径、系统内部逻辑、配置信息。
- 用到以后从内存中清楚高敏感信息。
- 遵循最小权限原则，尽可能以最小权限运行应用程序。
- 将其他与安全相关的信息记录到文档中。

## 性能问题

程序的性能非常重要，不仅考虑到时间性能，还要考虑到空间性能。

代码审查对性能问题的关注点：
- 尽可能避免低效的算法。推荐阅读：[算法复杂度](https://blankspace.blog.csdn.net/article/details/101903721)
- 避免创建不必要的对象。例如，单例模式、享元模式等设计模式对此有帮助。
- 注意字符串连接的性能损失。例如，String的+会被转换为StringBuilder的append()。
- 避免过度使用同步，并保持同步代码块范围尽可能小。
- 注意算法中潜在的死锁或活锁。推荐阅读：[死锁](https://blankspace.blog.csdn.net/article/details/115462223)
- 确保正确配置线程池和缓存。

# 代码审查的启发思考

每个程序员都有难以容忍的事情，比如用空格代替Tab做代码格式化、大括号位置和空格缩进等。

这种事情很让人烦恼但也不难以修改，下面是一些可以导致深层问题的情况：
- 空catch块常常意味着代码逻辑的缺失，即程序员明知道代码可能出错却没有采取任何措施。
- 无意义的命名说明代码缺乏清晰可读性，变量名类名方法名等应该能够顾名思义而不是令人匪夷所思。
- 明显重复的代码块早晚会出现问题，修改往往不能同步。
- 拥挤、难以理解的代码通常难以维护。
- 通常来说，如果单一方法或函数的代码量达到数百行，一般就违反了单一职责原则，会给代码维护带来问题。
- 无意义的代码注释只会浪费篇幅，代码本身就已经告诉你如何完成的了，代码注释只是告诉你为什么要这么做。
- 莫名其妙的幻数是理解代码的主要障碍，有意义的常量可以解决这个问题。
- 每个编译器警告都是一个潜在的Bug，应该在出问题前修复它。
- 无意义的冗余代码通常说明软件的设计思路不清晰。
- 如果一段代码和项目中的其他代码明显不一致，那肯定是犯了某种错误。
- 一连串的if-then-else可或者switch-case可以用字典代替，后者更为清晰。
- 不可测试的代码一般是结构不良造成的，违反SOLID原则。
