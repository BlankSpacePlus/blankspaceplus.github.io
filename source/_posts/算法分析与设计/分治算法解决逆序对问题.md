---
title: 分治算法解决逆序对问题
date: 2020-04-28 10:00:24
summary: 本文基于分治算法求解逆序对问题（洛谷P1908题），用Java编程实现。
mathjax: true
tags:
- 算法
- Java
categories:
- 算法分析与设计
---

# 题目描述

猫猫 TOM 和小老鼠 JERRY 最近又较量上了，但是毕竟都是成年人，他们已经不喜欢再玩那种你追我赶的游戏，现在他们喜欢玩统计。

最近，TOM 老猫查阅到一个人类称之为“逆序对”的东西，这东西是这样定义的：对于给定的一段正整数序列，逆序对就是序列中 $a_i>a_j$ 且 $i<j$ 的有序对。知道这概念后，他们就比赛谁先算出给定的一段正整数序列中逆序对的数目。注意序列中可能有重复数字。

# 输入格式

第一行，一个数 $n$，表示序列中有 $n$个数。

第二行 $n$ 个数，表示给定的序列。序列中每个数字不超过 $10^9$。

# 输出格式

输出序列中逆序对的数目。

# 样例 #1

## 样例输入 #1

```
6
5 4 2 6 3 1
```

## 样例输出 #1

```
11
```

# 提示

对于 $25\%$ 的数据，$n \leq 2500$

对于 $50\%$ 的数据，$n \leq 4 \times 10^4$。

对于所有数据，$n \leq 5 \times 10^5$

请使用较快的输入输出

# 分析

\<1, 2, 3, 4, 5\> 是一组数据，它是全部顺序无逆序的。
如果我们给出这样一组数据：\<1, 3, 2, 4, 5\> ，它只有 2、3 之间是反的，逆序对的数目是1。
如果我们给出这样一组数据：\<1, 3, 4, 2, 5\> ，它有 2、3 和 2、4 之间是反的，逆序对的数目是2。
……

$n \leq 5 \times 10^5$，$O(n^2)$的算法不可接受，要寻找$O(n\log{n})$的算法。

正确的思路是采用分治算法求解，参考[归并排序](https://blankspace.blog.csdn.net/article/details/113806051)。

在每次合并的时候，要么顺序保留要么逆序交换，所以在合并和交换的时候做一下统计就能得到答案。

统计结果的时候，Java要用long，C++要用longlong。

读取数据的时候，Java要用java.io.BufferedReader，按行读取字符串。

# Java实现代码

```java
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class Main {

    private static long result = 0;

    private static int[] nums, temp;

    private static void mergeSort(int left, int right) {
        if (left == right) {
            return;
        }
        int mid = (left+right)/2, i = left, j = mid+1, k = left;
        mergeSort(left, mid);
        mergeSort(j, right);
        while (i <= mid && j <= right) {
            if (nums[i] <= nums[j]) {
                temp[k++] = nums[i++];
            } else {
                temp[k++] = nums[j++];
                result += mid-i+1;
            }
        }
        while (i <= mid) {
            temp[k++] = nums[i++];
        }
        while (j <= right) {
            temp[k++] = nums[j++];
        }
        for (int m = left; m <= right; m++) {
            nums[m] = temp[m];
        }
    }

    public static void main(String[] args) throws IOException {
        BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));
        int num = Integer.parseInt(reader.readLine());
        String[] array = reader.readLine().split("\\s+");
        reader.close();
        nums = new int[num];
        temp = new int[num];
        for (int i = 0; i < num; i++) {
            nums[i] = Integer.parseInt(array[i]);
        }
        mergeSort(0, num-1);
        System.out.println(result);
    }

}
```

# 提交代码

[洛谷 P1226 【模板】快速幂||取余运算](https://www.luogu.com.cn/problem/P1908)
