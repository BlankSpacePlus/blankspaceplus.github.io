<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SPECjvm2008必知必会, 星拱北辰">
    <meta name="description" content="空白格的个人博客">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>SPECjvm2008必知必会 | 空白格</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="空白格" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">空白格</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">空白格</div>
        <div class="logo-desc">
            
            空白格的个人博客
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/BlankSpacePlus" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Follow Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/BlankSpacePlus" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Follow Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/9.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SPECjvm2008必知必会</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java/">
                                <span class="chip bg-color">Java</span>
                            </a>
                        
                            <a href="/tags/SPECjvm2008/">
                                <span class="chip bg-color">SPECjvm2008</span>
                            </a>
                        
                            <a href="/tags/Benchmark/">
                                <span class="chip bg-color">Benchmark</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Java/" class="post-category">
                                Java
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-08-13
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-08-28
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    21.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    92 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><p><a target="_blank" rel="noopener" href="https://www.spec.org/">SPEC</a>是一个非营利性组织，旨在建立、维护和认可用于评估最新一代计算系统性能和能源效率的标准化基准和工具。SPEC开发基准套件，并审查并发布来自SPEC的成员组织和其他基准许可方提交的结果。</p>
<p>SPECjvm2008是一个基准测试套件，包含几个现实场景的应用程序和一些专注于核心Java功能的基准测试。SPEC旨在通过SPECjvm2008基准来衡量系统和在这些系统上运行的JVM的整体性能。</p>
<p>下面是一些SPECjvm2008的关键基本信息：</p>
<ul>
<li>SPECjvm2008是由Java小组的核心设计团队开发的。AMD、BEA、HP、IBM、Intel、Sun都参与了该产品的设计、实施和测试阶段。</li>
<li>SPECjvm2008计划在2006年发布，测试和其他延迟导致发布于2008年，因此命名为SPECjvm2008。</li>
<li>SPECjvm2008测试JRE在典型Java应用程序上的性能，包括JAXP、Crypto库，不包括JavaEE内容（EJB、Servlet、JSP等）。SPECjvm2008的测试结果可以反映出JVM内部的各种组件，例如JRE、JIT、Java内存管理系统、线程和同步功能。</li>
<li>SPECjvm2008在执行JRE的上下文中测量操作系统和硬件的性能，可以反映硬件处理器和内存子系统的性能（内核和处理器数量的影响、处理器频率、整数和浮点运算、高速缓存层次结构、内存子系统）。</li>
<li>SPECjvm2008对文件I/O的依赖性低（执行期间对文件的读写操作较少甚至几乎没有），并且不包括远程网络I/O。这是为了尽量减少文件I/O操作对SPECjvm2008基准测试的影响，以便更好地集中在计算和内存访问等方面的性能测量，获得更准确的性能测量结果。</li>
<li>SPECjvm2008除了测试吞吐量以外，还关注Java用户体验。</li>
<li>SPECjvm2008的jar包中包含其全部源码。</li>
<li>SPECjvm2008的源码也被公开在<a target="_blank" rel="noopener" href="https://github.com/connorimes/SPECjvm2008">GitHub</a>上。</li>
<li>SPECjvm2008只能在单个JVM实例中工作，侧重于执行单个应用程序的JRE的性能。</li>
<li>SPECjvm2008支持多线程，不局限于SPECjvm98的单线程支持，在设计时也考虑到了现代多核处理器。运行SPECjvm2008工作负载的单个JVM实例将生成足够多的线程来对底层硬件系统施加压力。</li>
<li>SPECjvm2008采用定时运行的运行模式，其中基准测试应尽可能在测量期内完成。</li>
<li>SPECjvm2008更偏向于服务器环境的Java性能测试，因为每个硬件线程的最低内存要求是512MB。</li>
<li>SPECjvm2008的结果发布于<a target="_blank" rel="noopener" href="https://www.spec.org/jvm2008/results/">SPEC官方网站</a>。</li>
<li>SPECjvm2008无法与任何其他基准进行比较。</li>
<li>SPECjvm2008的工作负载为JVM产品提供了许多改进代码生成、线程、内存管理、锁算法调整的帮助，这种改进可能体现在各个SPECjvm2008工作负载得分上。</li>
</ul>
<h1 id="关键名词"><a href="#关键名词" class="headerlink" title="关键名词"></a>关键名词</h1><ul>
<li>Operation：每次对基准测试工作负载的调用称为一个操作。测试框架会多次调用基准测试，使其在一次迭代中执行多个操作。</li>
<li>Iteration：一次迭代持续一定的时间，默认为240秒。在此期间，测试框架将启动多个操作，每当前一个操作完成后立即启动新的操作。它不会中止一个操作，而是等待操作完成后再停止。测试框架期望在一个迭代内完成至少5个操作。迭代的持续时间不会少于指定的时间，但如果操作花费的时间过长，根据预热期间的性能情况，可能会增加迭代的时间。</li>
<li>Warmup：第一次迭代可以称为预热迭代，默认的运行时间为120秒。预热迭代的结果不包括在基准测试结果中。如果想要跳过预热，可以将预热时间设置为0。</li>
<li>Parallelism：大多数基准测试都是并行运行的，即多个操作在单独的线程中同时启动。从测试框架的角度来看，这些线程相互独立工作，但工作负载的设计旨在引入一系列有趣的问题，包括在应用程序级别共享数据和工作，以及使用JVM内部共享的资源。</li>
<li>Analyzer：可以使用SPECjvm2008基准测试框架来分析运行过程中发生的情况（例如，查看基准测试运行期间的堆使用情况），以便了解和诊断产品。为了实现这一点，测试框架可以在基准测试运行期间运行一个或多个分析器。这些分析器将收集信息，并与基准测试结果一起提供结果。它将在报告的详细图表中绘制信息，其中绘制了每个基准测试操作，并且可以为每个迭代报告摘要指标。分析器可以在基准测试运行期间轮询信息，也可以实现回调方法，基于事件报告结果。</li>
<li>Startup Benchmark：启动基准测试测量JVM和应用程序的启动性能。ops/m指标是使用新启动的JVM（通过java.lang.Runtime.exec()）运行每个工作负载一次操作所需的时间来计算的。这既测试了基本的JVM启动时间，也测试了启动基准测试工作负载的时间，因为为了获得多个基准测试中的最佳得分，优化代码的热点区域至关重要。</li>
<li>SciMark Large and Small Workloads：SciMark工作负载使用小型和大型数据集大小进行运行。小型数据集适应大多数现代CPU架构上可用的L2缓存，并旨在测试JVM代码优化和计算性能，同时确保数据集仅在缓存中访问。大型数据集足够大，无法适应标准的L2缓存，并旨在测试针对内存和内存子系统性能的JVM优化。scimark.monte_carlo工作负载仅运行一次，因为它不使用可修改的计算数据集。</li>
</ul>
<h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>官方支持的组合：</p>
<ul>
<li>Java Virtual Machines:<ul>
<li>Apache Harmony (5.0)</li>
<li>BEA JRockit (5.0 and 6.0)</li>
<li>HP JVM for HP-UX</li>
<li>IBM J9 (5.0 and 6.0)</li>
<li>Java for Sun OS X</li>
<li>Sun HotSpot (5.0 and 6.0)</li>
</ul>
</li>
<li>Operating Systems:<ul>
<li>AIX</li>
<li>IBM i Operating System</li>
<li>HP-UX</li>
<li>Linux (multiple vendors and versions)</li>
<li>Solaris (9 and 10)</li>
<li>Z/OS</li>
<li>Windows (Server 2003, XP, Vista)</li>
</ul>
</li>
<li>Hardware Architectures:<ul>
<li>Itanium</li>
<li>PA RISC</li>
<li>IBM Power Systems</li>
<li>SPARC (Niagra and Ultra SPARC, 32-bits and 64-bits)</li>
<li>X86 (AMD (Opteron), Intel (Netburst and Core2), 32-bits and 64-bits)</li>
</ul>
</li>
<li>Scalability:<ul>
<li>Tested on as much as 8 sockets, 32 cores and 64 hardware threads.</li>
</ul>
</li>
</ul>
<p>SPECjvm2008基准测试运行的最低硬件条件：</p>
<ul>
<li>内存：512MB</li>
<li>外存：256MB</li>
<li>为了使用尽可能少的资源，可以只运行一个基准测试线程，使用选项<code>-bt 1</code>。但是，这会影响测试结果。</li>
</ul>
<p>SPECjvm2008旨在在使用更大的机器（由逻辑CPU的数量决定）时扩展工作负载。当工作负载增加时，实时数据量会增加，并且上述最小内存、外存（derby基准测试会将数据存储在磁盘上）容量将不够用。</p>
<p>查看WSL版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wsl -l -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看操作系统信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uname</span> -a  <span class="token comment"># 查看操作系统完整信息</span>
<span class="token function">uname</span> -s  <span class="token comment"># 查看操作系统内核名称</span>
<span class="token function">uname</span> -n  <span class="token comment"># 查看网络节点上的主机名</span>
<span class="token function">uname</span> -r  <span class="token comment"># 查看操作系统内核发行号</span>
<span class="token function">uname</span> -v  <span class="token comment"># 查看操作系统内核版本</span>
<span class="token function">uname</span> -m  <span class="token comment"># 查看主机的硬件架构名称</span>
<span class="token function">uname</span> -p  <span class="token comment"># 查看处理器类型或"unknown"</span>
<span class="token function">uname</span> -i  <span class="token comment"># 查看硬件平台或"unknown"</span>
<span class="token function">uname</span> -o  <span class="token comment"># 查看操作系统名称</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看系统CPU信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/cpuinfo <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"physical id"</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token operator">|</span><span class="token function">uniq</span><span class="token operator">|</span><span class="token function">wc</span> -l  <span class="token comment"># 查看物理CPU个数</span>
<span class="token function">cat</span> /proc/cpuinfo <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"processor"</span><span class="token operator">|</span><span class="token function">wc</span> -l  <span class="token comment"># 查看逻辑cpu的个数</span>
<span class="token function">cat</span> /proc/cpuinfo <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"cpu cores"</span> <span class="token operator">|</span> <span class="token function">uniq</span>  <span class="token comment"># 查看CPU核数</span>
<span class="token function">cat</span> /proc/cpuinfo  <span class="token comment"># 查看CPU型号</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看系统内存信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">free</span> -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看磁盘信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">df</span> -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看NVIDIA显卡配置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="版本约束"><a href="#版本约束" class="headerlink" title="版本约束"></a>版本约束</h1><p>查看java版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看javac版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">javac -version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Java5以下版本可能无法运行SPECjvm2008。</p>
<p>Java5可能遇到如下问题：</p>
<ul>
<li>BEA JRockit、HP JVM、Sun Hotspot等JVM产品依赖的Apache Xerces库存在竞争，可能导致<code>xml.transform</code>测试失败。可以使用<code>java -jar SPECjvm2008.jar -Dspecjvm.benchmark.threads.xml.tranform=1</code>命令采用一个基准测试线程来避免竞争。<br></li>
<li>Unix或Linux操作系统上，Sun Hotspot依赖的JAXP库解析目录字符串的方式存在问题，可能导致<code>xml.validation</code>测试出现<code>java.lang.NullPointerException</code>。可以用<code>java -jar SPECjvm2008.jar -xd </code>`pwd`<code>/resources/xml.validation</code>命令指定绝对路径来解决问题。</li>
</ul>
<p>Java6、Java7可能是比较合适的版本。</p>
<p>Java8及更高版本无法通过以下工作负载的测试：</p>
<ul>
<li><code>startup.compiler.compiler</code></li>
<li><code>startup.compiler.sunflow</code></li>
<li><code>compiler.compiler</code></li>
<li><code>compiler.sunflow</code></li>
</ul>
<p>Java9及更高版本无法通过以下工作负载的测试：</p>
<ul>
<li><code>startup.xml.transform</code></li>
<li><code>startup.xml.validation</code></li>
<li><code>xml.transform</code></li>
<li><code>xml.validation</code></li>
</ul>
<p>Java10及更高版本可能无法运行SPECjvm2008。</p>
<h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><p>Linux环境无法用<code>wget</code>直接绕过Oracle的登录限制下载安装包，因此只能通过下载到本机后传输到Linux机器的方式实现下载。</p>
<p>例如，下面的命令获得的不是正确的tar.gz文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://download.oracle.com/otn/java/jdk/7u80-b15/jdk-7u80-linux-x64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>当执行解压命令时会报错：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="安装配置Java8"><a href="#安装配置Java8" class="headerlink" title="安装配置Java8"></a>安装配置Java8</h2><p>解压JDK1.8压缩文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> -zxvf jdk-8u371-linux-x64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置Java8环境变量：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>向<code>/etc/profile</code>文件中添加下面的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.8.0_371
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$CLASSPATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/lib:<span class="token variable">$JAVA_HOME</span>/jre/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$JAVA_HOME</span>/jre/bin:<span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$SRILM</span>/bin/i686-m64:<span class="token variable">$SRILM</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$LD_LIBRARY_PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$PATH</span>:/tmp/bin"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改后立即生效：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将安装的JDK加入java/javac候选清单：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> update-alternatives --install /usr/bin/java java /home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.8.0_371/bin/java <span class="token number">300</span>
<span class="token function">sudo</span> update-alternatives --install /usr/bin/javac javac /home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.8.0_371/bin/javac <span class="token number">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改Ubuntu系统默认java/javac：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> update-alternatives --config java
<span class="token function">sudo</span> update-alternatives --config javac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="安装配置Java7"><a href="#安装配置Java7" class="headerlink" title="安装配置Java7"></a>安装配置Java7</h2><p>选择合适的Java安装包：</p>
<p>解压JDK1.7压缩文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> -zxvf jdk-7u80-linux-x64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置Java7环境变量：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>向<code>/etc/profile</code>文件中添加下面的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.7.0_80
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$JRE_HOME</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改后立即生效：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将安装的JDK加入java/javac候选清单：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> update-alternatives --install /usr/bin/java java /home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.7.0_80/bin/java <span class="token number">300</span>
<span class="token function">sudo</span> update-alternatives --install /usr/bin/javac javac /home/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/jdk1.7.0_80/bin/javac <span class="token number">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改Ubuntu系统默认java/javac：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> update-alternatives --config java
<span class="token function">sudo</span> update-alternatives --config javac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="安装配置SPECjvm2008"><a href="#安装配置SPECjvm2008" class="headerlink" title="安装配置SPECjvm2008"></a>安装配置SPECjvm2008</h2><p>下载SPECjvm2008：<br><br>获取<a target="_blank" rel="noopener" href="https://www.spec.org/jvm2008/">SPECjvm2008_1_01_setup.jar</a></p>
<p>WSL2环境安装SPECjvm2008会卡住，因为缺少依赖，可通过补全依赖解决：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> x11-apps
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> x11-session-utils
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> dconf-editor
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gedit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>安装SPECjvm2008(GUI)：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar ./SPECjvm2008_1_01_setup.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安装SPECjvm2008(Command Line)：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar ./SPECjvm2008_1_01_setup.jar -i console<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>SPECjvm2008配置文件的路径：</p>
<ul>
<li><code>SPECjvm2008/props/specjvm.properties</code>：负责整个套件的运行配置，例如指定需要运行的测试用例、测试迭代次数、每个用例跑完是否要GC等。</li>
<li><code>SPECjvm2008/props/specjvm.reporter.properties</code>：用于丰富报表的输出内容，显示一些无法通过自动检测得到的环境信息，例如内存型号、逻辑CPU个数等。</li>
</ul>
<p>SPECjvm2008配置文件<code>specjvm.properties</code>常见修改：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">specjvm.additional.properties.file</span><span class="token punctuation">=</span><span class="token value attr-value">props/specjvm.reporter.properties // 指定报表配置文件路径</span>
<span class="token key attr-name">specjvm.benchmark.analyzer.names</span><span class="token punctuation">=</span><span class="token value attr-value">HeapMemoryFreeAnalyzer HeapMemoryTotalAnalyzer // JVM堆分析器</span>
<span class="token key attr-name">specjvm.home.dir</span><span class="token punctuation">=</span><span class="token value attr-value">/home/&lt;user_name&gt;/SPECjvm2008 // SPEC_HOME路径</span>
<span class="token key attr-name">specjvm.iteration.time</span><span class="token punctuation">=</span><span class="token value attr-value">240s // 迭代时长</span>
<span class="token key attr-name">specjvm.startup.jvm_options</span><span class="token punctuation">=</span><span class="token value attr-value">-Xms1024m -Xmx1024m -XX:+UseConcMarkSweepGC // 默认JVM调优参数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>空白行和以字符<code>#</code>开头的行将被忽略。</p>
<p>安装成功测试：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar SPECjvm2008.jar -wt 5s -it 5s -bt <span class="token number">2</span> -i console -ikv compress<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="工作负载"><a href="#工作负载" class="headerlink" title="工作负载"></a>工作负载</h1><p>SPECjvm2008在<code>spec.harness.SpecJVMBenchmark</code>中定义了5种工作负载类型。</p>
<ul>
<li><code>single</code>：<code>spec.harness.SpecJVMBenchmark.SINGLE</code>，仅启动基准测试的一个实例。<ul>
<li>如果基准测试是单线程工作负载，则预计会采用此类型。</li>
<li>如果基准测试本身处理多线程平衡，则预计会采用此类型。</li>
</ul>
</li>
<li><code>multi</code>：<code>spec.harness.SpecJVMBenchmark.MULTI</code>，启动多个基准测试实例。<ul>
<li>如果基准测试可以并且应该在多个彼此相邻的实例上运行，则预计会采用此类型。</li>
</ul>
</li>
<li><code>functional</code>：<code>spec.harness.SpecJVMBenchmark.FUNCTIONAL</code>，功能测试，仅用一个线程运行一次并报告通过或失败(无分数)，仅用来检查其是否符合规范。</li>
<li><code>stress</code>：<code>spec.harness.SpecJVMBenchmark.STRESS</code>，压力测试，启动多个实例并运行完整的运行时间，也会报告通过或失败。<ul>
<li>如果基准测试是对系统施加压力的功能测试，并且要求它运行一段时间而没有问题，则预计会采用此类型。</li>
</ul>
</li>
<li><code>invalid</code>：<code>spec.harness.SpecJVMBenchmark.INVALID</code>，暂未明确类型。</li>
</ul>
<p>SPECjvm2008提供了以下38项工作负载：</p>
<ul>
<li><code>startup.helloworld</code>：测试HelloWorld程序从运行开始到结束所需的时间。</li>
<li><code>startup.compiler.compiler</code>：测试普通Java编译所需要的时间。</li>
<li><code>startup.compiler.sunflow</code>：测试编译Sunflow图像渲染引擎所需要的时间。</li>
<li><code>startup.compress</code>：测试压缩程序，单次压缩所需的时间。</li>
<li><code>startup.crypto.aes</code>：测试AES/DES加密算法单次加密解密所需的时间。输入数据长度为100B、713KB。</li>
<li><code>startup.crypto.rsa</code>：测试RSA加密算法单次加密解密需要的时间。输入数据长度为100B、16KB。</li>
<li><code>startup.crypto.signverify</code>：测试单次使用MD5withRSA、SHA1withRSA、SHA1withDSA、SHA256withRSA来签名，识别所需要的时间。输入数据长度为1KB、65KB、1MB。</li>
<li><code>startup.mpegaudio</code>：测试单次mpeg音频解码所需的时间。</li>
<li><code>startup.scimark.fft</code>：测试单次快速傅立叶变换所需的时间。</li>
<li><code>startup.scimark.lu</code>：测试单次矩阵LU分解所需的时间。</li>
<li><code>startup.scimark.monte_carlo</code>：测试单次运行蒙特卡罗算法所需的时间。</li>
<li><code>startup.scimark.sor</code>：测试单次运行矩阵Jacobi逐次超松弛迭代法所需的时间。</li>
<li><code>startup.scimark.sparse</code>：测试单次稀疏矩阵乘积所需的时间。</li>
<li><code>startup.serial</code>：测试单次通过Socket传输Java序列化对象到对端反序列化完成所需的时间（基于JBoss Serialization Benchmark）。</li>
<li><code>startup.sunflow</code>：测试单次图片渲染处理所需的时间。</li>
<li><code>startup.xml.transform</code>：测试单次XML转换所需的时间，转换包括DOM、SAX、Stream方式。</li>
<li><code>startup.xml.validation</code>：测试单次XMLSchema校验所需的时间。</li>
<li><code>compiler.compiler</code>：在规定时间内，多线程迭代测试OpenJDK编译器的编译，得出ops/m。</li>
<li><code>compiler.sunflow</code>：在规定时间内，多线程迭代测试sunflow图像渲染的编译，得出ops/m。</li>
<li><code>compress</code>：在规定时间内，多线程迭代测试压缩，得出ops/m。</li>
<li><code>crypto.aes</code>：在规定时间内，多线程迭代测试AES/DES加解密算法，得出ops/m。</li>
<li><code>crypto.rsa</code>：在规定时间内，多线程迭代测试RSA加解密算法，得出ops/m。</li>
<li><code>crypto.signverify</code>：在规定时间内，多线程迭代测试使用MD5withRSA、SHA1withRSA、SHA1withDSA、SHA256withRSA来签名，识别，得出ops/m。</li>
<li><code>derby</code>：在规定时间内，迭代测试数据库相关逻辑，包括数据库锁、BigDecimal计算等，最后得出ops/m。</li>
<li><code>mpegaudio</code>：在规定时间内，多线程迭代mpeg音频解码，得出ops/m。</li>
<li><code>scimark.fft.large</code>：在规定时间内，多线程迭代测试快速傅立叶变换（按位反转、时间复杂度$O(n\log{n})$），使用32M大数据集，最后得出ops/m。</li>
<li><code>scimark.lu.large</code>：在规定时间内，多线程迭代测试矩阵LU分解（计算密集型、$2048×2048$），执行线性代数核(BLAS)和密集矩阵运算，使用32M大数据集，最后得出ops/m。</li>
<li><code>scimark.sor.large</code>：在规定时间内，多线程迭代测试矩阵（$2048×2048$）Jacobi逐次超松弛迭代法，在有限差分应用程序中练习典型的访问模式，采用用基本的“网格平均”记忆模式，使用32M大数据集，最后得出ops/m。</li>
<li><code>scimark.sparse.large</code>：在规定时间内，多线程迭代测试稀疏矩阵（$200000×200000$、4000000个非0数值）乘积，对数据集进行间接寻址和非常规内存引用，使用32M大数据集，最后得出ops/m。</li>
<li><code>scimark.fft.small</code>：在规定时间内，多线程迭代测试快速傅立叶变换（按位反转、时间复杂度$O(n\log{n})$），使用512K小数据集，最后得出ops/m。</li>
<li><code>scimark.lu.small</code>：在规定时间内，多线程迭代测试矩阵LU分解（计算密集型、$100×100$），执行线性代数核(BLAS)和密集矩阵运算，使用512KB小数据集，最后得出ops/m。</li>
<li><code>scimark.sor.small</code>：在规定时间内，多线程迭代测试矩阵（$250×250$）Jacobi逐次超松弛迭代法，在有限差分应用程序中练习典型的访问模式，采用用基本的“网格平均”记忆模式，使用512KB小数据集，最后得出ops/m。</li>
<li><code>scimark.sparse.small</code>：在规定时间内，多线程迭代测试稀疏矩阵乘积（$25000×25000$、62500个非0数值），对数据集进行间接寻址和非常规内存引用，使用512KB小数据集，最后得出ops/m。</li>
<li><code>scimark.monte_carlo</code>：在规定时间内，多线程迭代测试蒙特卡罗算法，对$[0,1]$上的四分之一圆$y=\sqrt{1-x^{2}}$积分近似求$\pi$，对$[0,1]$上的单位正方形及其内切圆计算随机点分布在圆内与圆外的比率，得出ops/m。<code>scimark.monte_carlo</code>只运行一次，但要经过large和small数据集上的计算。</li>
<li><code>serial</code>：在规定时间内，多线程迭代测试通过Socket传输Java序列化对象到对端反序列化（基于JBoss Serialization Benchmark），得出ops/m。</li>
<li><code>sunflow</code>：在规定时间内，利用Sunflow多线程迭代测试图片渲染，得出ops/m。</li>
<li><code>xml.transform</code>：在规定时间内，多线程迭代测试XML转换，通过使用DOM、SAX、Stream源执行XSLT转换来执行JAXP实现，采用了10个源自日常生活的数据样例，得出ops/m。</li>
<li><code>xml.validation</code>：在规定时间内，多线程迭代测试XMLSchema验证，根据XMLSchema验证XML实例文档来执行JAXP实现，采用了6个源自日常生活的数据样例，得出ops/m。</li>
</ul>
<p>这些工作负载可以分为11类：</p>
<table>
<thead>
<tr>
<th align="center">工作负载类别</th>
<th align="center">工作负载数量</th>
<th align="center">工作负载清单</th>
<th align="left">类别信息说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>compiler</code></td>
<td align="center">2</td>
<td align="center"><code>compiler.compiler</code><br><code>compiler.sunflow</code></td>
<td align="left">该基准测试使用OpenJDK前端编译器来编译一组.java文件。所编译的代码包括javac本身和SPECjvm2008中的sunflow子基准。该基准测试使用SPEVjvm2008实现的spec.benchmarks.compiler.SpecFileManager来处理内存、缓存，而不是进行磁盘和文件系统操作，以期减少I/O的影响。采用’-proc:none’选项可以使该基准测试与1.5版本兼容。</td>
</tr>
<tr>
<td align="center"><code>compress</code></td>
<td align="center">1</td>
<td align="center"><code>compress</code></td>
<td align="left">该基准测试使用修改后的Lempel-Ziv算法(LZW)对数据进行压缩，查找常见的子字符串并用可变长度的编码替换它们。该算法是确定性的，并且可以即时执行。该算法来源于<a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/1659158">Welch, “A Technique for High-Performance Data Compression,” in Computer, vol. 17, no. 6, pp. 8-19, June 1984, doi: 10.1109/MC.1984.1659158.</a>，使用大约为67KB的内部表和基于输入数据的伪随机访问。该基准测试继承自SPECjvm98，测试的数据量从90KB扩展到3.36MB。为了最大限度地减少I/O的影响，数据被缓冲。当JVM生成和处理混合长度数据访问时，此工作负载会执行即时编译、内联、数组访问和缓存性能。</td>
</tr>
<tr>
<td align="center"><code>crypto</code></td>
<td align="center">3</td>
<td align="center"><code>crypto.aes</code><br><code>crypto.rsa</code><br><code>crypto.signverify</code></td>
<td align="left">该基准测试侧重于加密领域的不同方面，并分为三个不同的子基准测试。这些不同的基准测试使用产品内部的实现，因此重点关注协议的供应商实现以及执行方式。<br><code>aes</code>加密和解密使用AES和DES协议，使用CBC/PKCS5Padding和CBC/NoPadding。输入数据大小为100B、713KB。<br><code>rsa</code>加密和解密使用RSA协议，使用输入数据大小为100B、16KB。<br><code>signverify</code>使用MD5withRSA、SHA1withRSA、SHA1withDSA、SHA256withRSA协议进行签名和验证，输入数据大小为1KB、65KB、1MB。</td>
</tr>
<tr>
<td align="center"><code>derby</code></td>
<td align="center">1</td>
<td align="center"><code>derby</code></td>
<td align="left">该基准测试使用纯Java编写的开源数据库derby。启动此工作负载时会实例化多个数据库，每4个线程共享一个数据库实例。该基准测试与业务逻辑结合，在对数据库（特别是锁）测试的同时，会针对java.math.BigDecimal进行压力测试。java.math.BigDecimal的计算数值尽量超过64位二进制，以便不仅仅关注“简单”的java.math.BigDecimal。该基准测试是SPECjvm98的db基准测试的直接替代，但具备更强的功能，并且尽可能接近一个真实的应用程序。</td>
</tr>
<tr>
<td align="center"><code>mpegaudio</code></td>
<td align="center">1</td>
<td align="center"><code>mpegaudio</code></td>
<td align="left">该基准测试与SPECjvm98的mpegaudio非常相似，只是其中mp3库已被替换为JLayer。JLayer主要依赖浮点数运算，对mp3解码任务表现良好。</td>
</tr>
<tr>
<td align="center"><code>scimark large</code></td>
<td align="center">5</td>
<td align="center"><code>scimark.fft.large</code><br><code>scimark.lu.large</code><br><code>scimark.sor.large</code><br><code>scimark.sparse.large</code><br><code>scimark.monte_carlo</code></td>
<td align="left">这个基准测试是由NIST开发的，被业界广泛使用作为一个浮点数基准测试，主要针对密集数学计算的浮点运算和数据访问模式。每个子测试（fft、lu、monte_carlo、sor、sparse）都被纳入SPECjvm2008中。这个测试有两个版本，这里是使用“大”数据集，数据量有32MB，对对内存子系统进行压力测试，测试缓存外系统性能。</td>
</tr>
<tr>
<td align="center"><code>scimark small</code></td>
<td align="center">5</td>
<td align="center"><code>scimark.fft.small</code><br><code>scimark.lu.small</code><br><code>scimark.sor.small</code><br><code>scimark.sparse.small</code><br><code>scimark.monte_carlo</code></td>
<td align="left">这个基准测试是由NIST开发的，被业界广泛使用作为一个浮点数基准测试。每个子测试（fft、lu、monte_carlo、sor、sparse）都被纳入SPECjvm2008中。这个测试有两个版本，这里是使用“小”数据集，数据量有512KB，对JVM进行压力测试。</td>
</tr>
<tr>
<td align="center"><code>serial</code></td>
<td align="center">1</td>
<td align="center"><code>serial</code></td>
<td align="left">该基准测试对基本类型和引用类型进行序列化和反序列化，使用了JBoss基准测试的数据。该基准测试采用生产者-消费者场景，生产者线程通过socket发送序列化的对象，并由同一系统上的消费者线程进行反序列化。该基准测试重点测试java.lang.Object.equals()方法，需要调用java.lang.reflect包。</td>
</tr>
<tr>
<td align="center"><code>startup</code></td>
<td align="center">17</td>
<td align="center"><code>startup.helloworld</code><br><code>startup.compiler.compiler</code><br><code>startup.compiler.sunflow</code><br><code>startup.compress</code><br><code>startup.crypto.aes</code><br><code>startup.crypto.rsa</code><br><code>startup.crypto.signverify</code><br><code>startup.mpegaudio</code><br><code>startup.scimark.fft</code><br><code>startup.scimark.lu</code><br><code>startup.scimark.monte_carlo</code><br><code>startup.scimark.sor</code><br><code>startup.scimark.sparse</code><br><code>startup.serial</code><br><code>startup.sunflow</code><br><code>startup.xml.transform</code><br><code>startup.xml.validation</code></td>
<td align="left">该基准测试为每个操作启动一个新的JVM，并从开始到结束进行时间测量。启动基准测试是单线程的，这允许在启动时进行多线程JVM优化。启动器必须与提交时的“main”JVM相同。可以修改启动器和启动器参数。每个启动基准测试都使用单个基准测试作为启动基准测试的参数，除了derby。其中，startup.scimark基准测试使用512千字节的数据集。</td>
</tr>
<tr>
<td align="center"><code>sunflow</code></td>
<td align="center">1</td>
<td align="center"><code>sunflow</code></td>
<td align="left">该基准测试使用开源的全局光照渲染系统进行图形可视化的测试。sunflow库在内部是多线程的，即可以运行多个依赖线程束以渲染图像。此工作负载是浮点繁重的，其高对象分配率会对内存带宽造成压力。实际应用中，只需要4个内部sunflow线程即可符合要求，具体线程数可以通过属性specjvm.benchmark.sunflow.threads.per.instance进行配置，不能超过16个。默认情况下，基准测试工具将使用基准线程数的一半，即会并行运行与硬件线程数一半相当的sunflow基准测试实例。这可以在specjvm.benchmark.threads.sunflow中进行配置。</td>
</tr>
<tr>
<td align="center"><code>xml</code></td>
<td align="center">2</td>
<td align="center"><code>xml.transform</code><br><code>xml.validation</code></td>
<td align="left">该基准测试有两个子基准测试：xml.transform、XML.validation，每个用例对工作负载得分的影响大致相同。两种XML工作负载都具有高对象分配率和高级别的争用锁。此外，它们还涉及大量的字符串操作。<br><code>xml.transform</code>通过将样式表（.xsl文件）应用于XML文档来测试JRE对javax.xml.transform（及其相关API）的实现。样式表和XML文档是几个实际示例，其大小和所使用的样式表功能各不相同（从3KB到156KB）。对xml.transform进行结果验证比对其他基准测试进行结果验证更复杂，因为不同的XML样式表处理器可能会产生略有不同但仍然正确的结果。<br>操作过程：首先，在测量间隔开始之前，运行一次工作负载并收集输出，对其进行规范化处理（符合规范化XML格式的规范）并与预期的规范化输出进行比较。在进行规范化之前，将产生HTML的转换输出转换为XML。此外，从此输出生成一个校验和。在测量间隔内，仅使用校验和检查每个操作的输出。<br><code>xml.transform</code>的一次“操作”包括处理每个样式表/文档对，并以DOM源、SAX源和流源访问XML文档。为了确保每个样式表/文档对对于单个操作所花费的时间大致相等，一些输入对在一个操作期间会被多次处理。<br><code>xml.validation</code>通过使用XML模式（.xsd文件）对XML实例文档进行验证，测试JRE对javax.xml.validation（及其相关API）的实现。模式和XML文档是几个实际示例，其大小和所使用的XML模式功能各不相同（从1KB到607KB）。xml.validation的一个“操作”包括处理每个样式表/文档对，并以DOM源和SAX源访问XML文档。与xml.transform类似，一些输入对在一个操作期间会被多次处理，以确保每个输入对对于单个操作所花费的时间大致相等。</td>
</tr>
</tbody></table>
<p>通过对工作负载及其分组的联合分析，我们可以发现：</p>
<ol>
<li>helloworld工作负载没有吞吐量测试。</li>
<li>除了derby，非startup（吞吐量测试）工作负载分组的工作负载都有对应的startup（启动）工作负载项。</li>
</ol>
<h1 id="测试周期"><a href="#测试周期" class="headerlink" title="测试周期"></a>测试周期</h1><p>SPECjvm2008提供了21项测试基准：</p>
<ul>
<li><code>compiler.compiler</code></li>
<li><code>compiler.sunflow</code></li>
<li><code>compress</code></li>
<li><code>crypto</code></li>
<li><code>crypto.aes</code></li>
<li><code>crypto.rsa</code></li>
<li><code>crypto.signverify</code></li>
<li><code>derby</code></li>
<li><code>helloworld</code></li>
<li><code>mpegaudio</code></li>
<li><code>scimark.fft</code></li>
<li><code>scimark.lu</code></li>
<li><code>scimark.monte_carlo</code></li>
<li><code>scimark.sor</code></li>
<li><code>scimark.sparse</code></li>
<li><code>serial</code></li>
<li><code>startup</code></li>
<li><code>startup.helloworld</code></li>
<li><code>sunflow</code></li>
<li><code>xml.transform</code></li>
<li><code>xml.validation</code></li>
</ul>
<p>SPECjvm2008的一项基准测试需要2分钟（120s）的预热时间和4分钟（240s）的测量运行时间。在此期间，多项不被中断的操作将被执行，直到所有线程都完成了在测量间隔内开始的操作才会终止。实际的测量周期会长于预估的4分钟，某些情况下时间甚至会明显增加。<br><br>因此，总的执行时间至少为$21×6=126$分钟，即大约2小时。</p>
<p>为了保证公平和准确性、确保在测量期内开始的每个操作都会对测量结果产生影响，SPECjvm2008的操作会继续执行直到所有在测量期内开始的操作都完成（即使测量期已经结束），但只有在测量期内执行的部分会被计算在内。<br>如果有一部分操作在测量期内开始但没有在期内完成，那么它对测量结果的贡献程度将取决于它在测量期内执行的时间比例，这个数值位于0到1之间。为了确保在测量期外执行操作不会有任何优势，测试框架会继续执行线程，直到所有在测量期内开始的操作都完成为止。这样可以确保测量结果的准确性，并使不同操作在相同条件下进行比较。</p>
<p>SPECjvm2008关注秒为单位的操作时长。通过连续运行多个操作（很可能是短时间的操作）并持续一段时间，会出现一些典型的JVM问题，例如内存系统的负载（分配、垃圾回收等），这是Java性能的关键。当连续运行基准测试操作4分钟时，JVM需要处理这些”副作用”。</p>
<h2 id="预热阶段"><a href="#预热阶段" class="headerlink" title="预热阶段"></a>预热阶段</h2><p>在进行Java性能测试时，预热（warm-up）是一个重要的步骤。预热是指在实际进行性能测试之前，先运行一段时间的代码，让JVM有足够的时间来进行优化和准备。</p>
<ul>
<li>完成JVM优化：Java虚拟机在执行代码时会进行各种优化，如即时编译（Just-In-Time Compilation）、内联优化等。这些优化需要一定的时间来生效。通过进行预热，可以让JVM在真正的性能测试之前完成优化过程，使得测试结果更加准确。与此同时，JIT编译器会根据代码的执行情况来动态优化代码，预热可以让JIT编译器收集足够的执行数据，以便更好地进行优化。</li>
<li>完成类加载和初始化：Java应用程序通常涉及大量的类加载和初始化操作。在预热阶段，JVM可以加载和初始化所有相关的类，避免在性能测试期间由于类加载导致的性能波动。</li>
<li>完成缓存预热：在Java应用程序中，缓存对性能有着重要的影响。在预热阶段，可以通过模拟实际运行场景来预先填充缓存，使得性能测试期间的缓存命中率更接近真实情况。</li>
</ul>
<h1 id="属性配置"><a href="#属性配置" class="headerlink" title="属性配置"></a>属性配置</h1><ul>
<li><code>specjvm.additional.properties.file</code>：SPECjvm2008额外配置文件路径。</li>
<li><code>specjvm.benchmarks=startup.helloworld startup.compiler.compiler startup.compiler.sunflow startup.compress startup.crypto.aes startup.crypto.rsa startup.crypto.signverify startup.mpegaudio startup.scimark.fft startup.scimark.lu startup.scimark.monte_carlo startup.scimark.sor startup.scimark.sparse startup.serial startup.sunflow startup.xml.transform startup.xml.validation compiler.compiler compiler.sunflow compress crypto.aes crypto.rsa crypto.signverify derby mpegaudio scimark.fft.large scimark.lu.large scimark.sor.large scimark.sparse.large scimark.fft.small scimark.lu.small scimark.sor.small scimark.sparse.small scimark.monte_carlo serial sunflow xml.transform xml.validation</code>：SPECjvm2008默认运行的工作负载。SPECjvm2008工作负载名称的任何子集都是合理的取值。</li>
<li><code>specjvm.benchmarks.derby.debug=*</code>：是否为derby设置DEBUG标志。取值包括true和false，默认值为false。</li>
<li><code>specjvm.io.validation.debug=*</code>：是否为I/O设置DEBUG标志进行验证。取值包括true和false，默认值为false。</li>
<li><code>specjvm.benchmarks.startup.debug=</code>：是否为启动基准设置DEBUG标志。取值包括true和false，默认值为false。</li>
<li><code>specjvm.benchmark.analyzer.frequency=</code>：工作负载执行期间分析器运行的时间间隔。默认取值为1s。</li>
<li><code>specjvm.benchmark.analyzer.names=""*</code>：测试期间运行的分析器的名称。取值为<code>spec.harness.analyzer</code>包中的类名称，默认值为false。<ul>
<li><code>spec.harness.analyzer.HeapMemoryFreeAnalyzer</code></li>
<li><code>spec.harness.analyzer.HeapMemoryTotalAnalyzer</code></li>
<li><code>spec.harness.analyzer.TempAnalyzer</code></li>
<li><code>spec.harness.analyzer.PowerAnalyzer</code></li>
<li><code>spec.harness.analyzer.PollingAnalyzerExample</code></li>
<li><code>spec.harness.analyzer.CallbackAnalyzerExample</code></li>
</ul>
</li>
<li><code>spec.harness.analyzer.PowerAnalyzer.host=&lt;host name&gt;</code>：<code>spec.harness.analyzer.PowerAnalyzer</code>应连接到的SPEC PTDaemon主机名。默认值为127.0.0.1。</li>
<li><code>spec.harness.analyzer.PowerAnalyzer.port=&lt;port&gt;</code>：<code>spec.harness.analyzer.PowerAnalyzer</code>应连接到的SPEC PTDaemon端口。默认值为8888。</li>
<li><code>spec.harness.analyzer.TempAnalyzer.host=&lt;host name&gt;</code>：<code>spec.harness.analyzer.TempAnalyzer</code>应连接到的SPEC PTDaemon主机名。默认值为127.0.0.1。</li>
<li><code>spec.harness.analyzer.TempAnalyzer.port=&lt;port&gt;</code>：<code>spec.harness.analyzer.TempAnalyzer</code>应连接到的SPEC PTDaemon端口。默认值为8889。</li>
<li><code>specjvm.benchmark.delay=0s&lt;5,0s&lt;5</code>：每个基准测试之前应该有多长时间的暂停。取值范围是小于5s，默认值为0s。</li>
<li><code>specjvm.benchmark.startup.launcher=,</code>：启动基准测试所使用的新JVM的命令行。默认为空。</li>
<li><code>specjvm.benchmark.startup.scimark.all=!</code>：取值包括true和false，默认值为false。</li>
<li><code>specjvm.benchmark.startup.crypto.all=!</code>：取值包括true和false，默认值为false。</li>
<li><code>specjvm.benchmark.sunflow.threads.per.instance=4=</code>用于sunflow基准测试的每个实例的线程数。取值范围是正整数，默认值是4。</li>
<li><code>specjvm.benchmark.systemgc=!</code>：每个基准测试之前是否应强制执行垃圾收集。</li>
<li><code>specjvm.benchmark.threads=#hwt*</code>：所有基准测试的线程数。默认值为硬件线程数，取值范围是正整数。<ul>
<li><code>specjvm.benchmark.threads.check=1=</code>：check任务的线程数。默认值为1，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.startup=#hwt</code>：startup基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.compress=#hwt</code>：compress基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.compiler.compiler=#hwt</code>：compiler.compiler基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.compiler.hello=#hwt</code>：compiler.hello基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.compiler.sunflow=0.5x#hwt*</code>：compiler.sunflow基准测试的线程数。默认值为硬件线程数的一半，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.crypto.aes=#hwt</code>：crypto.aes基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.crypto.hash=#hwt</code>：hash任务的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.crypto.rsa=#hwt</code>：crypto.rsa基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.crypto.signverify=#hwt</code>：crypto.signverify基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.derby=#hwt</code>：derby基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.mpegaudio=#hwt</code>：mpegaudio基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.scimark.fft=#hwt</code>：scimark.fft基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.scimark.lu=#hwt</code>：scimark.lu基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.scimark.monte_carlo=#hwt</code>：scimark.monte_carlo基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.scimark.sor=#hwt</code>：scimark.sor基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.scimark.sparse=#hwt</code>：scimark.sparse基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.serial=#hwt</code>：serial基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.xml.transform=#hwt</code>：xml.transform基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
<li><code>specjvm.benchmark.threads.xml.validation=#hwt</code>：xml.validation基准测试的线程数。默认值为硬件线程数，取值范围是正整数。</li>
</ul>
</li>
<li><code>specjvm.benchmark.warmup.time=120s</code>：SPECjvm2008基准测试花费在预热的时间。默认值为120s。</li>
<li><code>specjvm.benchmark.xml.transform.leave.out.dir=!</code>：取值包括true和false，默认值为false。</li>
<li><code>specjvm.benchmark.xml.transform.out.dir=!</code>：取值为目录名。</li>
<li><code>specjvm.benchmark.xml.validation.input.dir=none</code>：取值为目录名，默认值为specbasedir/resources/xml.validation。可以设置为resources/xml.validation以解决Linux上的JDK1.5错误。</li>
<li><code>specjvm.create.html.report=true*</code>：是否创建HTML报告。取值包括true和false，默认值为true。</li>
<li><code>specjvm.create.txt.report=true*</code>：是否创建TXT报告。取值包括true和false，默认值为true。</li>
<li><code>specjvm.create.xml.report=true</code>：是否创建XML报告。取值包括true和false，默认值为true。</li>
<li><code>specjvm.generateValidityCheckFiles=false</code>：是否生成有效性检查文件。取值包括true和false，默认值为false。</li>
<li><code>specjvm.hardware.threads.override=*,!</code>：机器硬件线程数。默认值为JVM可用的实际硬件线程数，取值范围是正整数。如果修改了默认值，则本次测试是不合规的。</li>
<li><code>specjvm.home.dir=.*</code>：SPECjvm2008安装根目录。在命令行上设置此属性没有效果。</li>
<li><code>specjvm.iteration.delay=0s&lt;5,0s&lt;5</code>：每次迭代之间的暂停时间。取值范围是小于5s，默认值为0s。</li>
<li><code>specjvm.iteration.time=240s</code>：每次基准测试运行的持续时间(1次迭代)。默认值为120s。base模式下的取值应小于240s，peak模式下的取值应大于等于240s，Lagom模式下的取值是0s。</li>
<li><code>specjvm.iteration.time.forced=!,!</code>：是否强制每次迭代的持续时间。取值包括true和false，默认值为false。合规的基准测试中，该属性只能是false值。</li>
<li><code>specjvm.iteration.systemgc=false=,false=</code>：是否应在每次迭代之间强制执行垃圾收集。取值包括true和false，默认值为false。合规的基准测试中，该属性只能是false值。</li>
<li><code>specjvm.fixed.operations=!,-1*</code>：Lagom模式运行的固定操作次数。取值是正整数。<ul>
<li><code>specjvm.fixed.operations.compiler.compiler=!,20=</code>：Lagom模式compiler.compiler工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.compiler.sunflow=!,20=</code>：Lagom模式compiler.sunflow工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.compress=!,50=</code>：Lagom模式compress工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.crypto.aes=!,20=</code>：Lagom模式crypto.aes作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.crypto.rsa=!,150=</code>：Lagom模式crypto.rsa工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.crypto.signverify=!,125=</code>：Lagom模式crypto.signverify工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.derby=!,30=</code>：Lagom模式derby工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.mpegaudio=!,50=</code>：Lagom模式mpegaudio工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.fft.large=!,10=</code>：Lagom模式scimark.fft.large工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.fft.small=!,100=</code>：Lagom模式scimark.fft.small工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.lu.large=!,4=,</code>：Lagom模式scimark.lu.large工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.lu.small=!,125=</code>：Lagom模式scimark.lu.small工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.monte_carlo=!,900=</code>：Lagom模式scimark.monte_carlo工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.sor.large=!,15=</code>：Lagom模式scimark.sor.large工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.sor.small=!,75=</code>：Lagom模式scimark.sor.small工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.sparse.large=!,10=</code>：Lagom模式scimark.sparse.large工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.scimark.sparse.small=!,25=</code>：Lagom模式scimark.sparse.small工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.serial=!,25=</code>：Lagom模式serial工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.sunflow=!,30=</code>：Lagom模式sunflow工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.xml.transform=!,7=</code>：Lagom模式xml.transform工作负载运行的固定操作次数。取值是正整数。</li>
<li><code>specjvm.fixed.operations.xml.validation=!,40=</code>：Lagom模式xml.validation工作负载运行的固定操作次数。取值是正整数。</li>
</ul>
</li>
<li><code>specjvm.maxiter=1*,1*</code>：自动模式下最多运行的迭代次数。默认值为1，取值范围是正整数。<ul>
<li><code>specjvm.maxiter.check=1*,1*</code>：自动模式下check最多运行的迭代次数。默认值为1，取值范围是正整数。</li>
</ul>
</li>
<li><code>specjvm.miniter=1*,1*</code>：自动模式下最少运行的迭代次数。默认值为1，取值范围是正整数。<ul>
<li><code>specjvm.miniter.check=1*,1*</code>：自动模式下check最少运行的迭代次数。默认值为1，取值范围是正整数。</li>
</ul>
</li>
<li><code>specjvm.print.verbose=false*</code>：线程是否应该打印额外信息。取值包括true和false，默认值为false。</li>
<li><code>specjvm.print.progress=false*</code>：是否在每次循环后打印一个点，以查看进度。取值包括true和false，默认值为false。</li>
<li><code>specjvm.propfile=*,!</code>：属性文件名。默认值为空，可以改成任何有效文件名。</li>
<li><code>specjvm.result.dir=./results*</code>：结果保存目录。默认值为./results，可以改成任何有效文件夹名。</li>
<li><code>specjvm.run.initial.check=true=</code>：是否应该进行运行检查。取值包括true和false，默认值为true，合规值为true。</li>
<li><code>specjvm.scimark.size=DEFAULT=</code>：scimark基准测试的问题大小。</li>
<li><code>specjvm.spin.at.end=false=</code>：当启动器线程在自旋过程中没有获得资源的访问权限时，强制启动器线程休眠。取值包括true和false，默认值为false。取值包括true和false，默认值为false，合规值为false。</li>
<li><code>specjvm.startup.jvm_options=*,*</code>：启动基准JVM选项。默认值为空，合法的JVM参数都符合要求。</li>
<li><code>specjvm.validity.checksum=true=</code>：是否测试基准jar文件的校验和。取值包括true和false，默认值为true，合规值为true。</li>
<li><code>specjvm.verify=true=</code>：输出是否已验证。取值包括true和false，默认值为true，合规值为true。如果值为false，则从stdout输出。</li>
</ul>
<h1 id="测试启动"><a href="#测试启动" class="headerlink" title="测试启动"></a>测试启动</h1><h2 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h2><p>完整命令格式：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java <span class="token punctuation">[</span><span class="token operator">&lt;</span>jvm options<span class="token operator">&gt;</span><span class="token punctuation">]</span> -jar SPECjvm2008.jar <span class="token punctuation">[</span><span class="token operator">&lt;</span>SPECjvm2008 options<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>benchmark name<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>运行示例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar SPECjvm2008.jar --help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>SPECjvm2008启动参数如下：</p>
<table>
<thead>
<tr>
<th align="center">短参数</th>
<th align="center">长参数</th>
<th align="center">值类型</th>
<th align="center">属性名称</th>
<th align="center">详细描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-h</td>
<td align="center">–help</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">显示帮助信息</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">–version</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">输出SPECjvm2008版本并退出</td>
</tr>
<tr>
<td align="center">-sv</td>
<td align="center">–showversion</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">输出SPECjvm2008版本并继续</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">–base</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">运行SPECjvm2008的基本吞吐量测量（默认参数）</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">–peak</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">运行SPECjvm2008的峰值吞吐量测量</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">–lagom</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">运行Lagom基准套件（采用固定的工作负载）</td>
</tr>
<tr>
<td align="center">-pf</td>
<td align="center">–propfile</td>
<td align="center">string</td>
<td align="center">specjvm.propfile</td>
<td align="center">引入属性配置文件</td>
</tr>
<tr>
<td align="center">-i</td>
<td align="center">–iterations</td>
<td align="center">int</td>
<td align="center">specjvm.miniter, specjvm.maxniter</td>
<td align="center">指定运行的迭代次数（<code>inf</code>代表无限）</td>
</tr>
<tr>
<td align="center">-mi</td>
<td align="center">–miniter</td>
<td align="center">int</td>
<td align="center">specjvm.miniter</td>
<td align="center">设置最小迭代次数</td>
</tr>
<tr>
<td align="center">-ma</td>
<td align="center">–maxiter</td>
<td align="center">int</td>
<td align="center">specjvm.maxniter</td>
<td align="center">设置最大迭代次数</td>
</tr>
<tr>
<td align="center">-it</td>
<td align="center">–iterationtime</td>
<td align="center">time</td>
<td align="center">specjvm.iteration.time</td>
<td align="center">设置一次迭代持续的时间，例如<code>4m</code>，可选单位有<code>ms</code>、<code>s</code>、<code>m</code>、<code>h</code><br>如果迭代时间太短，会根据预热结果调整为期望至少完成5次操作</td>
</tr>
<tr>
<td align="center">-fit</td>
<td align="center">–forceIterationIime</td>
<td align="center">time</td>
<td align="center">specjvm.iteration.time, specjvm.iteration.time.forced</td>
<td align="center">强制设置迭代时间，但不会根据warmup结果调整时间</td>
</tr>
<tr>
<td align="center">-ja</td>
<td align="center">–jvmArgs</td>
<td align="center">string</td>
<td align="center">specjvm.startup.jvm_options</td>
<td align="center">启动子测试的JVM选项</td>
</tr>
<tr>
<td align="center">-jl</td>
<td align="center">–jvmLauncher</td>
<td align="center">path</td>
<td align="center">specjvm.benchmark.startup.launcher</td>
<td align="center">启动子测试的JVM启动器</td>
</tr>
<tr>
<td align="center">-wt</td>
<td align="center">–warmuptime</td>
<td align="center">time</td>
<td align="center">specjvm.benchmark.warmup.time</td>
<td align="center">设置预热时间，例如<code>2m</code>，可选单位有<code>ms</code>、<code>s</code>、<code>m</code>、<code>h</code></td>
</tr>
<tr>
<td align="center">-ops</td>
<td align="center">–operations</td>
<td align="center">int</td>
<td align="center">specjvm.fixed.operations, specjvm.run.type</td>
<td align="center">设置每次迭代将包含多少个操作，这将明确一个固定的工作负载，迭代时间将被忽略</td>
</tr>
<tr>
<td align="center">-bt</td>
<td align="center">–benchmarkThreads</td>
<td align="center">int</td>
<td align="center">specjvm.benchmark.threads</td>
<td align="center">设置需要使用的基准线程数</td>
</tr>
<tr>
<td align="center">-r</td>
<td align="center">–reporter</td>
<td align="center">raw file name</td>
<td align="center"></td>
<td align="center">从给定的文件中引入reporter，基准测试将不会运行</td>
</tr>
<tr>
<td align="center">-v</td>
<td align="center">–verbose</td>
<td align="center"></td>
<td align="center">specjvm.print.verbose, specjvm.print.progress</td>
<td align="center">输出详细信息（仅限测试框架）</td>
</tr>
<tr>
<td align="center">-pja</td>
<td align="center">–parseJvmArgs</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">从命令行解析JVM参数信息</td>
</tr>
<tr>
<td align="center">-coe</td>
<td align="center">–continueOnError</td>
<td align="center"></td>
<td align="center">specjvm.continue.on.error</td>
<td align="center">允许测试失败时继续运行套件</td>
</tr>
<tr>
<td align="center">-ict</td>
<td align="center">–ignoreCheckTest</td>
<td align="center"></td>
<td align="center">specjvm.run.initial.check</td>
<td align="center">不运行检查基准</td>
</tr>
<tr>
<td align="center">-ikv</td>
<td align="center">–ignoreKitValidation</td>
<td align="center"></td>
<td align="center">specjvm.run.checksum.validation</td>
<td align="center">不运行校验和验证基准</td>
</tr>
<tr>
<td align="center">-crf</td>
<td align="center">–createRawFile</td>
<td align="center">boolean</td>
<td align="center">specjvm.create.xml.report</td>
<td align="center">设置是否生成原始文件</td>
</tr>
<tr>
<td align="center">-ctf</td>
<td align="center">–createTextFile</td>
<td align="center">boolean</td>
<td align="center">specjvm.create.txt.report</td>
<td align="center">设置是否生成文本报告，如果raw禁用则txt也禁用</td>
</tr>
<tr>
<td align="center">-chf</td>
<td align="center">–createHtmlFile</td>
<td align="center">boolean</td>
<td align="center">specjvm.create.html.report</td>
<td align="center">设置是否生成html报告，如果raw禁用则html也禁用</td>
</tr>
<tr>
<td align="center">-xd</td>
<td align="center">–xmlDir</td>
<td align="center">path</td>
<td align="center">specjvm.benchmark.xml.validation.input.dir</td>
<td align="center">设置XML输入文件路径</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;benchmark(s)&gt;</td>
<td align="center"></td>
<td align="center">specjvm.benchmarks</td>
<td align="center">注明要运行的全部基准测试的名称，默认运行所有基准</td>
</tr>
</tbody></table>
<h2 id="启动原理"><a href="#启动原理" class="headerlink" title="启动原理"></a>启动原理</h2><p>从<code>src/META-INF/specjvm2008.mf</code>中查看到如下信息：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Manifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">1.0</span>
<span class="token class-name">Main</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">spec<span class="token punctuation">.</span>harness<span class="token punctuation">.</span></span>Launch</span>
<span class="token class-name">Class</span><span class="token operator">-</span><span class="token class-name">Path</span><span class="token operator">:</span> lib<span class="token operator">/</span>derby<span class="token punctuation">.</span>jar lib<span class="token operator">/</span>jl1<span class="token punctuation">.</span><span class="token number">0.</span>jar lib<span class="token operator">/</span>jcommon<span class="token operator">-</span><span class="token number">1.0</span><span class="token number">.9</span><span class="token punctuation">.</span>jar lib<span class="token operator">/</span>jfreechart<span class="token operator">-</span><span class="token number">1.0</span><span class="token number">.5</span><span class="token punctuation">.</span>jar lib<span class="token operator">/</span>sunflow<span class="token punctuation">.</span>jar lib<span class="token operator">/</span>janino<span class="token punctuation">.</span>jar lib<span class="token operator">/</span>javac<span class="token punctuation">.</span>jar lib<span class="token operator">/</span>xom<span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">.</span>jar lib<span class="token operator">/</span><span class="token class-name">Tidy</span><span class="token punctuation">.</span>jar lib<span class="token operator">/</span>check<span class="token punctuation">.</span>jar build<span class="token operator">/</span>classes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这意味着SPECjvm2008的jar包Main类是<code>spec.harness.Launch</code>。</p>
<p><code>spec.harness.Launch::main()</code>方法是SPECjvm2008的入口，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">public static void main<span class="token punctuation">(</span>String <span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Properties commandLineProps <span class="token operator">=</span> new Properties<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolean cont <span class="token operator">=</span> CommandLineParser.parseArgs<span class="token punctuation">(</span>args, commandLineProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cont <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    runBenchmarkSuite<span class="token punctuation">(</span>commandLineProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>spec.harness.CommandLineParser::parseArgs()</code>方法逐一解析命令行参数列表，将数据解析到<code>java.util.Properties</code>入参中。在一个for循环中不断地if…else if…else…，选择语句的判断条件通过部分硬编码和<code>spec.harness.Constants</code>实现。<code>spec.harness.CommandLineParser::parseArgs()</code>执行完毕后，解析命令行参数后得到的<code>commandLineProps</code>对象将被用于性能测试。</p>
<p>随后，<code>spec.harness.Launch::main()</code>方法调用<code>spec.harness.Launch::runBenchmarkSuite()</code>方法：</p>
<ol>
<li>从<code>-pf</code>(<code>--propfile</code>)参数标明的属性配置文件中读取运行属性参数，存入<code>spec.harness.CommandLineParser.commandLineProps</code>。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> pf <span class="token operator">=</span> commandLineProps<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PROPFILE_PROP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties <span class="token operator">=</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">readProperties</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error reading properites file '"</span> <span class="token operator">+</span> pf <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 其中，<code>spec.harness.CommandLineParser::parseArgs()</code>读取<code>specjvm.propfile</code>的过程并存入<code>commandLineProps</code>的过程如下： <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"-pf"</span><span class="token punctuation">)</span> <span class="token operator">||</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"--propfile"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PROPFILE_PROP<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Argument: "</span> <span class="token operator">+</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" expects a value."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// result dir</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>向<code>spec.harness.Configuration</code>的<code>userProperties</code>属性添加命令行参数（覆盖属性文件中的参数）。现向<code>userProperties</code>属性中添加<code>commandLineProps</code>所有的key-value对（哈希表key重复时会直接覆盖value），再向<code>userProperties</code>属性中添加key为<code>specjvm.home.dir</code>的key-value对。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>commandLineProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>HOMEDIR_PROP<span class="token punctuation">,</span> specjvmHomeDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
verbose <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>VERBOSE_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Util::getBoolProperty()</code>方法支持在不同的情况下获取benchmark特定的属性值或基本属性值，并根据属性值的字符串表示来确定最终的布尔值。该方法的两个入参propname、bmName分别表示属性的基本名称、benchmark的名称。该方法的返回值类型为boolean类型，当value为”true”或”1”时返回true，否则返回false。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> propname<span class="token punctuation">,</span> <span class="token class-name">String</span> bmName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token function">getProperty</span><span class="token punctuation">(</span>propname<span class="token punctuation">,</span> bmName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span> <span class="token operator">||</span> value<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Util::getProperty()</code>方法查找属性的流程：<ol>
<li>尝试获取benchmark特定的属性值，即<code>&lt;propname&gt;.&lt;bmname&gt;</code>。</li>
<li>如果找不到benchmark特定的属性值，则尝试获取基本属性值，即<code>&lt;propname&gt;</code>。</li>
<li>如果仍然找不到，则返回属性的默认值。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> propname<span class="token punctuation">,</span> <span class="token class-name">String</span> bmName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bmName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> bmName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"check"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// check需要特判</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> <span class="token function">getPropertyHelper</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties<span class="token punctuation">,</span> propname<span class="token punctuation">,</span> bmName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token function">getPropertyHelper</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">,</span> propname<span class="token punctuation">,</span> bmName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token function">getPropertyHelper</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties<span class="token punctuation">,</span> propname<span class="token punctuation">,</span> bmName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li>设置基准测试的上下文自增1。其中，<code>spec.harness.Context</code>是一个容器类，它包含了一些参数，用于保存基准测试运行时的特定参数，比如运行时间、速度、打开的文件数、缓存的文件数、SPECjvm2008根目录、用于显示跟踪的控制台窗口等。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">setupContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SuiteResult</span> sResult <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getSuiteResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
 其中，<code>spec.harness.CommandLineParser::setupContext()</code>获取<code>specjvm.home.dir</code>、<code>specjvm.result.dir</code>、<code>specjvm.verify</code>，赋给<code>spec.harness.Context</code>中的<code>specBasePath</code>、<code>specResultDirBase</code>、<code>verify</code>静态属性。<br><br> <code>verbose</code>由上一步读取<code>specjvm.print.verbose</code>属性获得。当<code>verbose</code>取值为true时，<code>spec.harness.Context::staticToString()</code>输出<code>"Context: base=" + specBasePath</code>。<br><br> 最后，为初始化一个<code>spec.harness.results.SuiteResult</code>类型的<code>suiteResult</code>对象。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setupContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setSpecBasePath</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>HOMEDIR_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setResultDirNameBase</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>RESULT_DIR_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setVerify</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>VERIFY_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">staticToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setSuiteResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SuiteResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>从SPECjvm2008根目录下的<code>version.txt</code>文件中读取<code>Benchmark</code>、<code>Kit_version</code>、<code>Build_date</code>属性数据，拼接成<code>version</code>字符串，赋给<code>sResult</code>对象的<code>kitVersion</code>属性。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> version <span class="token operator">=</span> <span class="token string">"n/a"</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">Properties</span> bp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bp<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>specjvmHomeDir <span class="token operator">+</span> <span class="token string">"/version.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> versionNumber <span class="token operator">=</span> bp<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"Kit_version"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> buildDate <span class="token operator">=</span> bp<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"Build_date"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> benchName <span class="token operator">=</span> bp<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"Benchmark"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    version <span class="token operator">=</span> benchName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> versionNumber <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> buildDate <span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
sResult<span class="token punctuation">.</span><span class="token function">setKitVersion</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 事实上，<code>version.txt</code>的文件内容如下所示： <pre class="line-numbers language-text" data-language="text"><code class="language-text">Benchmark=     SPECjvm2008
Kit_version=   1.01
Build_user=    dagastin
Build_date=    20090519<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>检查配置<code>specjvm.print.progress</code>、<code>specjvm.benchmarks</code>、<code>specjvm.propfile</code>、<code>specjvm.continue.on.error</code>、<code>specjvm.run.initial.check</code>、<code>specjvm.run.checksum.validation</code>。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">checkSetup</span><span class="token punctuation">(</span>sResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">StopBenchmarkException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">ProgramRunner</span><span class="token punctuation">.</span><span class="token function">setPrintProgress</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PRINT_PROGRESS_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> benchmarks <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>BENCHMARKS_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> propfile <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PROPFILE_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> continueOnError <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CONTINUE_ON_ERROR_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> doCheckTest <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>INITIAL_CHECK_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> doCheckSumCheck <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>INITIAL_CHECKSUM_CHECK_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Configuration::checkSetup()</code>方法执行一系列运行前检查工作：<ol>
<li>获取<code>specjvm.benchmarks</code>属性的值，即待运行的所有基准测试名称。如果值为null，即未指定要运行的基准测试名称，则抛出<code>spec.harness.StopBenchmarkException</code>异常。</li>
<li>获取<code>spec.harness.Launch.workLoad</code>的值，如果其值为<code>"not set"</code>，则运行模式未设置，需要根据一系列条件判断是base模式还是peak模式。<br>如果满足以下全部条件，则按照base模式运行；否则，按照peak模式运行：<ul>
<li>未指定JVM参数。</li>
<li>未指定启动JVM选项。</li>
<li>迭代次数为默认值(1次)。</li>
<li>热身时间(120s)和运行时间(240s)为默认值。</li>
</ul>
</li>
<li>循环遍历<code>defaultProperties</code>中的所有属性，并根据<code>benchmarks</code>来检查和验证这些属性的值。</li>
<li>代码检查并验证<code>userProperties</code>中的属性，确保它们在<code>defaultProperties</code>中存在或者属于合法的benchmark。</li>
<li>设置分析器的类，以及在出现异常时抛出<code>spec.harness.StopBenchmarkException</code>异常。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkSetup</span><span class="token punctuation">(</span><span class="token class-name">SuiteResult</span> sResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> benchmarks <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>BENCHMARKS_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>benchmarks <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StopBenchmarkException</span><span class="token punctuation">(</span><span class="token string">"No benchmarks specified, property is null."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Launch</span><span class="token punctuation">.</span>workLoad<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>WORKLOAD_NAME_NOT_SET<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Check if this is a base or a peak run (lagom would not end up here)</span>
    	<span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> allJvmArgs <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">parseDefaultJvmArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jvmOptionsStartup <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>STARTUP_JVM_OPTIONS_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">// If JVM arguments are used, it is a peak run.</span>
        		<span class="token punctuation">(</span>allJvmArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> allJvmArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"n/a"</span><span class="token punctuation">)</span>
        				<span class="token operator">||</span> allJvmArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">||</span> allJvmArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-showversion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        	<span class="token comment">// If JVM arguments are used, it is a peak run.</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>jvmOptionsStartup <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> jvmOptionsStartup<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"n/a"</span><span class="token punctuation">)</span>
                        <span class="token operator">||</span> jvmOptionsStartup<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">||</span> jvmOptionsStartup<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-showversion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        	    
            <span class="token comment">// If iterations are more than one, it is a peak run.</span>
        		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MINIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> 
        				<span class="token operator">||</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MINIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        				<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MINIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MAXIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> 
        				<span class="token operator">||</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MAXIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        				<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MAXIMUM_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    	   <span class="token comment">// If warmup time or run time time is changed, it is a peak run.</span>
        		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>WARMUPTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> 
        				<span class="token operator">||</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>WARMUPTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        				<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>WARMUPTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>RUNTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> 
        				<span class="token operator">||</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>RUNTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        				<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>RUNTIME_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties <span class="token operator">=</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultPropertiesSPECbase<span class="token punctuation">;</span>
        	<span class="token class-name">Configuration</span><span class="token punctuation">.</span>propsRequirements <span class="token operator">=</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>propsRequirementsSPECbase<span class="token punctuation">;</span>
            <span class="token class-name">Launch</span><span class="token punctuation">.</span>workLoad <span class="token operator">=</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WORKLOAD_NAME_SPEC_BASE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            defaultProperties <span class="token operator">=</span> defaultPropertiesSPECpeak<span class="token punctuation">;</span>
            propsRequirements <span class="token operator">=</span> propsRequirementsSPECpeak<span class="token punctuation">;</span>
            <span class="token class-name">Launch</span><span class="token punctuation">.</span>workLoad <span class="token operator">=</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WORKLOAD_NAME_SPEC_PEAK<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Go through all properties in default and validate what you get in default.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Enumeration</span> dk <span class="token operator">=</span> defaultProperties<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> dk<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> dk<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">validateProperty</span><span class="token punctuation">(</span>sResult<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> propsRequirements<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Go through all properties in default with benchmark addon and validate what you get in default.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StringTokenizer</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>benchmarks<span class="token punctuation">)</span><span class="token punctuation">;</span> st<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> bm <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">validateProperty</span><span class="token punctuation">(</span>sResult<span class="token punctuation">,</span> key <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> bm<span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getDefaultProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">,</span> propsRequirements<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Don't accept unknown properties.</span>
    <span class="token comment">// Go through all properties in jvm and make sure they are in default.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Enumeration</span> sk <span class="token operator">=</span> userProperties<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> sk<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> sk<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"spec.jvm2008.report"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">boolean</span> found <span class="token operator">=</span> defaultProperties<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StringTokenizer</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>VALID_BENCHMARKS_SPEC<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token operator">!</span>found <span class="token operator">&amp;&amp;</span> st<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> bm <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"."</span> <span class="token operator">+</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> shortKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> bm<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultProperties<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>shortKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    found <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">addViolation</span><span class="token punctuation">(</span>sResult<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">"Property "</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">" unknown."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check that analyzer classes are sound (and initiate classes).</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnalyzersRunner</span><span class="token punctuation">.</span><span class="token function">setupAnalyzerClasses</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ANALYZER_NAMES_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StopBenchmarkException</span><span class="token punctuation">(</span><span class="token string">"Error setting up analyzers: "</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 继续回到<code>spec.harness.Launch::runBenchmarkSuite()</code>方法，调用<code>spec.harness.Configuration::setupReportInfo()</code>方法配置结果报告信息。输出配置文件信息、分析器信息、根目录信息、基准测试信息。如果流程不合规，输出”WARNING: Run will not be compliant.”提示信息。最后，输出用户定义的属性、默认属性和属性要求的信息，暴露程序的配置情况。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">setupReportInfo</span><span class="token punctuation">(</span>sResult<span class="token punctuation">,</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
sResult<span class="token punctuation">.</span><span class="token function">setWorkloadName</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>NAME_OF_RUN_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>NAME_OF_RUN_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Properties file:   "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>propfile <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> propfile <span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PROPFILE_ADDITIONAL_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Properties file 2: "</span> <span class="token operator">+</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PROPFILE_ADDITIONAL_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AnalyzersRunner</span><span class="token punctuation">.</span><span class="token function">getNoAnalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Analyzers:         "</span> <span class="token operator">+</span> <span class="token class-name">AnalyzersRunner</span><span class="token punctuation">.</span><span class="token function">getAnalyzerNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getSpecBasePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Base dir:          "</span> <span class="token operator">+</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getSpecBasePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Benchmarks:        "</span> <span class="token operator">+</span> benchmarks<span class="token punctuation">)</span><span class="token punctuation">;</span>       
<span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sResult<span class="token punctuation">.</span><span class="token function">isCompliant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  WARNING: Run will not be compliant."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> sResult<span class="token punctuation">.</span><span class="token function">getViolations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">+</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"User defined properties:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">printProperties</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Default properties:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">printProperties</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>defaultProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Requirements:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">printReqs</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>propsRequirements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Context::getOut()</code>方法返回<code>java.io.PrintStream</code>类型的输出流，默认是stdout流，即<code>java.lang.System.out</code>。因此<code>spec.harness.Context.getOut().println()</code>默认等价于<code>java.lang.System.out.println()</code>。<br><br> 为了让该输出流对象对其他线程隔离（成为当前线程独有的变量），这里用<code>java.lang.ThreadLocal</code>类型的对象封装<code>java.io.PrintStream</code>类型的对象，通过get()方法获取<code>java.io.PrintStream</code>类型对象。其中，<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/ThreadLocal.html#initialValue()"><code>java.lang.ThreadLocal::initialValue()</code></a>被实现。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> tlOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token class-name">Object</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PrintStream</span> <span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">PrintStream</span><span class="token punctuation">)</span> tlOut<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li>确保基准测试存在（尽早发现拼写错误）。<br><br> 回顾<code>benchmarks</code>的由来，<code>String benchmarks = Util.getProperty(Constants.BENCHMARKS_PROP, null);</code>，而<code>spec.harness.Constants.BENCHMARKS_PROP</code>的值是<code>specjvm.benchmarks</code>。<code>specjvm.benchmarks</code>的默认值是<code>startup.helloworld startup.compiler.compiler startup.compiler.sunflow startup.compress startup.crypto.aes startup.crypto.rsa startup.crypto.signverify startup.mpegaudio startup.scimark.fft startup.scimark.lu startup.scimark.monte_carlo startup.scimark.sor startup.scimark.sparse startup.serial startup.sunflow startup.xml.transform startup.xml.validation compiler.compiler compiler.sunflow compress crypto.aes crypto.rsa crypto.signverify derby mpegaudio scimark.fft.large scimark.lu.large scimark.sor.large scimark.sparse.large scimark.fft.small scimark.lu.small scimark.sor.small scimark.sparse.small scimark.monte_carlo serial sunflow xml.transform xml.validation</code>，不同的benchmark是用空格分隔的，因此可以通过<code>java.util.StringTokenizer</code>来切分子串以遍历。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">boolean</span> cont <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StringTokenizer</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>benchmarks<span class="token punctuation">)</span><span class="token punctuation">;</span> st<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> bm <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">isBenchmark</span><span class="token punctuation">(</span>bm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Unknown benchmark: "</span> <span class="token operator">+</span> bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cont <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cont<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Aborting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>检查JAR文件和资源的校验和和签名，以便用户在输出之前就能得到一些结果。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>doCheckSumCheck<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> jarCheckResult <span class="token operator">=</span> <span class="token function">checkBenchmarkKit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jarCheckResult <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sResult<span class="token punctuation">.</span><span class="token function">addViolation</span><span class="token punctuation">(</span>jarCheckResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\n  Kit signature and checksum validation failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">+</span> jarCheckResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  WARNING: Run will not be compliant."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"passed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Launch::checkBenchmarkKit()</code>方法通过反射加载<code>spec.validity.Digests</code>。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">checkBenchmarkKit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"spec.validity.Digests"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"Digests.java missing. Checksum test will not be run."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Validate that jar files have not been altered</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Digests</span> digests <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Digests</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Kit signature and checksum is validated."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  This can take several minutes."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Use argument '-ikv' to skip this."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> res <span class="token operator">=</span> digests<span class="token punctuation">.</span><span class="token function">crunch_jars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"Checksum test failed for jar files ("</span> <span class="token operator">+</span> res <span class="token operator">+</span> <span class="token string">"). Kit may not be changed or rebuild."</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
        res <span class="token operator">=</span> digests<span class="token punctuation">.</span><span class="token function">crunch_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"Checksum test failed for resource files ("</span> <span class="token operator">+</span> res <span class="token operator">+</span> <span class="token string">"). Kit may not be changed or rebuild."</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"Checksum test throw exception, message: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// All good.</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.validity.Digests::crunch_jars()</code>、<code>spec.validity.Digests::crunch_resources()</code>方法的实现依赖于<code>spec.validity.Digests::crunch()</code>方法。<code>spec.validity.Digests::crunch()</code>方法计算文件的SHA校验和，并与预先计算好的校验和进行比较，以检查文件是否被正确地传输或存储。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">crunch_jars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> prefix <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getSpecBasePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> ret <span class="token operator">=</span> <span class="token function">crunch</span><span class="token punctuation">(</span><span class="token string">"Jar"</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">crunch_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> prefix <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getSpecBasePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/resources/"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> ret <span class="token operator">=</span> <span class="token function">crunch</span><span class="token punctuation">(</span><span class="token string">"Resource"</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">crunch</span><span class="token punctuation">(</span><span class="token class-name">String</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> prefix<span class="token punctuation">,</span> <span class="token keyword">int</span> step<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DigestDefinition</span> digests <span class="token operator">=</span> <span class="token function">createDigester</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get iterator of resource filenames to check</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> digests<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> ret <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> res <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> current <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> current_name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileInputStream</span> the_one <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>current_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> expected <span class="token operator">=</span> digests<span class="token punctuation">.</span><span class="token function">getArray</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DigestInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DigestInputStream</span><span class="token punctuation">(</span>the_one<span class="token punctuation">,</span> md<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>current_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">byte</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">", "</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> expected<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    res <span class="token operator">=</span> <span class="token string">"Checksum test failed on "</span> <span class="token operator">+</span> current<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>current <span class="token operator">+</span> <span class="token string">" validity is "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token string">"Digests: caught exception "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ret <span class="token operator">=</span> res<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                ret <span class="token operator">+=</span> <span class="token string">", "</span> <span class="token operator">+</span> res<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        	<span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">%</span> step <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        		out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>打开用于raw结果的文件。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> resultFileName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        resultFileName <span class="token operator">=</span> <span class="token function">openResultFile</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span>userProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>                
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Aborting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sResult<span class="token punctuation">.</span><span class="token function">headerToXml</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getXmlResultFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Launch::openResultFile()</code>方法创建结果文件。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">openResultFile</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> userProperties<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> resultDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getResultDirNameBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resultDir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resultDir<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Result dir "</span> <span class="token operator">+</span> resultDir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is a file and already exists."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resultDir<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Failed to create dir "</span> <span class="token operator">+</span> resultDir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> xmlFileName <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getNextRawFileInDir</span><span class="token punctuation">(</span>resultDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PrintStream</span> xmlPs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>xmlFileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setXmlResultFile</span><span class="token punctuation">(</span>xmlPs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xmlFileName<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>运行JVM的check基准测试。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BenchmarkResult</span> check <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>doCheckTest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    check <span class="token operator">=</span> <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span><span class="token string">"check"</span><span class="token punctuation">,</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>ITER<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> defaultMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sResult<span class="token punctuation">.</span><span class="token function">addBenchmarkResults</span><span class="token punctuation">(</span>check<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.Launch::runOneBenchmark()</code>方法先配置benchmark结果信息，随后通过start()方法启动<code>spec.harness.ProgramRunner</code>(<code>java.lang.Thread</code>派生类)线程。最后，通过join()方法让当前线程等待调用该方法的线程执行完成，即等待该线程执行结束后再继续执行当前线程。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BenchmarkResult</span> <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span><span class="token class-name">String</span> bm<span class="token punctuation">,</span> <span class="token keyword">int</span> runMode<span class="token punctuation">,</span> <span class="token keyword">int</span> fixedLoops<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BenchmarkResult</span> bmResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BenchmarkResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> startupMode<span class="token punctuation">)</span><span class="token punctuation">{</span>
        args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>bm<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>bm<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> scimarkMode<span class="token punctuation">)</span><span class="token punctuation">{</span>
        args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>bm<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>bm<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setNames</span><span class="token punctuation">(</span>bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setRunMode</span><span class="token punctuation">(</span>runMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setNumberOfLoops</span><span class="token punctuation">(</span>fixedLoops<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setIterationTime</span><span class="token punctuation">(</span>
            <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTimeProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>RUNTIME_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>FORCED_RUNTIME_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> miniter <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MINIMUM_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setMinIter</span><span class="token punctuation">(</span>miniter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> maxiter <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITERATIONS_MAXIMUM_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>maxiter <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> maxiter <span class="token operator">&lt;</span> miniter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// -1 means forever...</span>
        maxiter <span class="token operator">=</span> miniter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setMaxIter</span><span class="token punctuation">(</span>maxiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentNumberBmThreads <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getHwtCalcProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>BENCHMARK_THREADS_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setNumberBmThreads</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> startupMode<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> currentNumberBmThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setWarmupTime</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTimeProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>WARMUPTIME_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setIterationForcegc</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITER_DO_SYSTEMGC_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setIterationDelay</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTimeProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ITER_DELAYTIME_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setBenchmarkForcegc</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>BM_DO_SYSTEMGC_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setBenchmarkDelay</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTimeProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>BM_DELAYTIME_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setChecksum</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>VALIDITY_CHECKSUM_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setAnalyzers</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ANALYZER_NAMES_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmResult<span class="token punctuation">.</span><span class="token function">setAnalyzerFreq</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTimeProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>ANALYZER_FREQUENCY_PROP<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runMode <span class="token operator">==</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>ITER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bmResult<span class="token punctuation">.</span><span class="token function">setIterationTime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">setNumberOfLoops</span><span class="token punctuation">(</span>fixedLoops<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">setWarmupTime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ProgramRunner</span> runner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgramRunner</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    runner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        runner<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">addError</span><span class="token punctuation">(</span><span class="token string">"BenchmarkRunner failed to join: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bmResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.ProgramRunner::run()</code>方法调用<code>spec.harness.ProgramRunner::runBenchmark()</code>方法启动benchmark。 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> oldValue <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getVerify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setVerify</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">runBenchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setVerify</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Benchmark result:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">toXml</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
 <code>spec.harness.ProgramRunner::runBenchmark()</code>方法加载给定基准名称的类的实例。该方法调用类实例的harnessMain方法，在调用harnessMain方法之前记录开始时间。如果基准测试成功运行，则该方法返回基准测试运行参数。该方法完成基准测试运行后还会调用系统垃圾收集器，它会使用信息更新<code>spec.harness.results.BenchmarkResult</code>。</li>
<li>遍历<code>benchmarks</code>列表，调用<code>spec.harness.Launch::runOneBenchmark()</code>依次执行每个测试，并根据配置文件中的参数进行相应的运行类型和操作数设置。最后，将所有测试结果保存在sResult中。某一个benchmark运行错误时，后续的测试会被终止，以便及时发现并处理问题。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>check <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> check<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BenchmarkResult</span>  res<span class="token punctuation">;</span>
    <span class="token class-name">StringTokenizer</span> bmt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>benchmarks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>bmt<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> benchmark <span class="token operator">=</span> bmt<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> runType <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>TYPE_OF_RUN_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> fixedOpsNumber <span class="token operator">=</span> <span class="token punctuation">(</span>runType <span class="token operator">==</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>TIMED <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>FIXED_OPERATIONS_PROP<span class="token punctuation">,</span> benchmark<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BenchmarkThread</span><span class="token punctuation">.</span>createValidityCheckFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">,</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>ITER<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> defaultMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_BNAME_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_BNAME_LARGE_POSTFIX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">setupProp</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_SIZE_PROP<span class="token punctuation">,</span> <span class="token string">"LARGE"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">,</span> <span class="token string">"LARGE"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_BNAME_SMALL_POSTFIX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">setupProp</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_SIZE_PROP<span class="token punctuation">,</span> <span class="token string">"SMALL"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">,</span> <span class="token string">"SMALL"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">setupProp</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_SIZE_PROP<span class="token punctuation">,</span> <span class="token string">"DEFAULT"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">,</span> <span class="token string">"DEFAULT"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WHATEVER_REQ<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// benchmark = benchmark.substring(0,benchmark.lastIndexOf("."));</span>
            res <span class="token operator">=</span> <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">,</span> runType<span class="token punctuation">,</span> fixedOpsNumber<span class="token punctuation">,</span> scimarkMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> benchmark<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>STARTUP_BNAME_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">,</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>ITER<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> startupMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token function">runOneBenchmark</span><span class="token punctuation">(</span>benchmark<span class="token punctuation">,</span> runType<span class="token punctuation">,</span> fixedOpsNumber<span class="token punctuation">,</span> defaultMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sResult<span class="token punctuation">.</span><span class="token function">addBenchmarkResults</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>continueOnError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Benchmark "</span> <span class="token operator">+</span> benchmark <span class="token operator">+</span> <span class="token string">" failed. Aborting run."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"No benchmarks will be run, since initial check test failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">KnownIssues</span><span class="token punctuation">.</span><span class="token function">printKnownIssueJavacVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>释放分析器类资源。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">AnalyzersRunner</span><span class="token punctuation">.</span><span class="token function">tearDownAnalyzerClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<code>spec.harness.analyzer.AnalyzersRunner::tearDownAnalyzerClasses()</code>方法遍历所有的分析器类，调用其tearDownAnalyzerClass()方法，释放其资源。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"unchecked"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">tearDownAnalyzerClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[Analyzers] Tearing down analyzer classes."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> analyzerClasses<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Method</span> m <span class="token operator">=</span> analyzerClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"tearDownAnalyzerClass"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StopBenchmarkException</span><span class="token punctuation">(</span><span class="token string">"Error invoking "</span> <span class="token operator">+</span> analyzerClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".tearDownAnalyzerClass(). "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>处理结果。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sResult<span class="token punctuation">.</span><span class="token function">footerToXml</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getXmlResultFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closeResultFile</span><span class="token punctuation">(</span>resultFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>            
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>创建结果报告（可选生成产物）。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_HTML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token operator">||</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_TXT_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> rArgs <span class="token operator">=</span> <span class="token punctuation">{</span>
                resultFileName<span class="token punctuation">,</span>
                <span class="token string">"-sub"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
                <span class="token string">"-summary"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
                <span class="token string">"-txt"</span><span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_TXT_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"-html"</span><span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_TXT_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">createReport</span><span class="token punctuation">(</span>rArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfMemoryError</span> oome<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error while creating report. Out of Memory."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error while creating report: "</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>在运行结束时打印已知的问题，暴露更多的细节。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">KnownIssues</span><span class="token punctuation">.</span><span class="token function">printKnownIssuesInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>HARNESS_SPIN_AT_END_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Harness will sleep here."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// This is useful, if you want to attach to the process and look at what state it ended in.</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>前面提到,<code>spec.harness.ProgramRunner</code>类是<code>java.lang.Thread</code>的派生类，重写了<code>java.lang.Thread::run()</code>方法。创建线程对象后，系统通过<code>spec.harness.ProgramRunner::start()</code>启动线程，调用线程对象的<code>spec.harness.ProgramRunner::run()</code>方法来执行具体的任务。当启动线程后，<code>spec.harness.ProgramRunner::run()</code>方法会在新线程中被执行。而<code>spec.harness.ProgramRunner::run()</code>方法调用<code>spec.harness.ProgramRunner::runBenchmark()</code>方法以启动benchmark。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> oldValue <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getVerify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setVerify</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">runBenchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">setVerify</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Benchmark result:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">toXml</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>spec.harness.ProgramRunner::runBenchmark()</code>方法加载给定基准名称的类的实例。该方法调用类实例的harnessMain方法，在调用harnessMain方法之前记录开始时间。如果基准测试成功运行，则返回基准测试运行参数。完成基准测试运行后还会调用系统垃圾收集器。</p>
<ol>
<li>验证基准测试配置：首先检查是否设置了基准测试结果（bmResult），如果没有，则抛出一个StopBenchmarkException异常，表示基准测试没有正确设置。</li>
<li>运行预热阶段（Warmup）：如果基准测试需要预热（有设置预热时间），则进行预热阶段的运行。预热阶段的运行类似于正式的基准测试运行，但不计入最终的测试结果。预热的目的是让虚拟机进入稳定状态，以避免刚开始运行时的性能波动。</li>
<li>输出基准测试信息：在运行基准测试之前，输出基准测试的相关信息，包括基准测试的名称、运行模式、测试类型、线程数等。</li>
<li>运行基准测试迭代：根据最小迭代次数（miniter）和最大迭代次数（maxiter）的设置，依次运行基准测试的迭代。每次迭代的运行结果会记录在IterationResult对象中，包括迭代次数、预期运行时间等。</li>
<li>判断迭代是否终止：在每次迭代后，检查是否满足终止迭代的条件。如果已经达到最小迭代次数，并且连续两次迭代的运行结果相差不大（小于1%），则终止迭代。</li>
<li>运行结束：在所有迭代运行结束后，执行基准测试的结束操作（如果有），然后输出测试结果。如果测试出现错误，将错误信息输出；否则，输出”Valid run!”表示基准测试运行成功。</li>
</ol>
<p>输出测试结果：最后，输出基准测试的得分（如果不是功能测试）以及测试结果是否有效。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">runBenchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StopBenchmarkException</span><span class="token punctuation">(</span><span class="token string">"The benchmark is not setup properly. There is no BenchmarkResult with configuration."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> miniter <span class="token operator">=</span> bmResult<span class="token punctuation">.</span><span class="token function">getMinIter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> maxiter <span class="token operator">=</span> bmResult<span class="token punctuation">.</span><span class="token function">getMaxIter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> bmType <span class="token operator">=</span> <span class="token function">invokeBmTestTypeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">setBmType</span><span class="token punctuation">(</span>bmType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> bmName <span class="token operator">=</span> bmResult<span class="token punctuation">.</span><span class="token function">getLogicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Special case functional tests...</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bmType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">SpecJVMBenchmark</span><span class="token punctuation">.</span>FUNCTIONAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setNumberBmThreads</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setRunMode</span><span class="token punctuation">(</span><span class="token class-name">TestResult</span><span class="token punctuation">.</span>ITER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setNumberOfLoops</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setMinIter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setMaxIter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setNumberOfLoops</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setIterationTime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setWarmupTime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--- --- --- --- --- --- --- --- ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Benchmark:   "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getLogicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Run mode:    "</span> <span class="token operator">+</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span><span class="token function">getRunModeDescription</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getRunMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Test type:   "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getBmType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getNumberBmThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Threads:     "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getNumberBmThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getWarmupTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Warmup:      "</span> <span class="token operator">+</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span><span class="token function">millisAsSec</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getWarmupTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token string">"  Iterations:  "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>miniter <span class="token operator">&lt;</span> maxiter <span class="token operator">?</span> <span class="token string">"Auto run mode "</span> <span class="token operator">+</span> miniter <span class="token operator">+</span> <span class="token string">".."</span> <span class="token operator">+</span> maxiter <span class="token operator">:</span> <span class="token punctuation">(</span>maxiter <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"infinite"</span> <span class="token operator">:</span> <span class="token string">""</span> <span class="token operator">+</span> maxiter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Run length:  "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">durDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bmResult<span class="token punctuation">.</span><span class="token function">headerToXml</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getXmlResultFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>TAB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Clear file cache from previous benchmarks.</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getFileCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Allow VM to clean heap, if specified.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkForcegc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Allow a stable state before start.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkForcegc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Requests gc before starting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">runFinalization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Allow a period of rest before start.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Pause for "</span> <span class="token operator">+</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span><span class="token function">millisAsSec</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">pause</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Initiate things for the benchmark (if any).</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Put validity file in cache</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getVerify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">isScimarkAndNotMonteCarlo</span><span class="token punctuation">(</span>bmName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getFileCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token class-name">ValidityCheckOutputStream</span><span class="token punctuation">.</span><span class="token function">getValidityFileName</span><span class="token punctuation">(</span>bmName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bmName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getFileCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token class-name">ValidityCheckOutputStream</span><span class="token punctuation">.</span><span class="token function">getValidityFileName</span><span class="token punctuation">(</span>bmName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Run potential setup method</span>
            <span class="token function">invokeBmSetupBenchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Error in setup of Benchmark."</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">addError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getWarmupTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">IterationResult</span> itResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IterationResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setBenchmarkResult</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setExpectedDuration</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getWarmupTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setIteration</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">setWarmupResult</span><span class="token punctuation">(</span>itResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            valid <span class="token operator">=</span> <span class="token function">runIteration</span><span class="token punctuation">(</span><span class="token string">"Warmup ("</span> <span class="token operator">+</span> itResult<span class="token punctuation">.</span><span class="token function">durDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">,</span> itResult<span class="token punctuation">,</span> bmResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Adjust run tme based on warmup results, if needed.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bmResult<span class="token punctuation">.</span><span class="token function">getForcedIterationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>valid <span class="token operator">&amp;&amp;</span> itResult<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> bmResult<span class="token punctuation">.</span><span class="token function">getIterationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">long</span> dur <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5d</span> <span class="token operator">/</span> itResult<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>dur <span class="token operator">&gt;</span> bmResult<span class="token punctuation">.</span><span class="token function">getIterationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        bmResult<span class="token punctuation">.</span><span class="token function">setIterationTime</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> dur<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Warning: Current run time for one iteration is too low."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Increasing iteration time to "</span> <span class="token operator">+</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span><span class="token function">millisAsSec</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bmResult<span class="token punctuation">.</span><span class="token function">middleToXml</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getXmlResultFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>TAB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Initiate for automation run</span>
        <span class="token keyword">double</span> preRes1 <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">;</span>
        <span class="token keyword">double</span> preRes2 <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> iter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> valid <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>maxiter <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> iter <span class="token operator">&lt;=</span> maxiter<span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">IterationResult</span> itResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IterationResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setBenchmarkResult</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setExpectedDuration</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setExpectedLoops</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getNumberOfLoops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            itResult<span class="token punctuation">.</span><span class="token function">setIteration</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">addIterationResult</span><span class="token punctuation">(</span>itResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            valid <span class="token operator">=</span> <span class="token function">runIteration</span><span class="token punctuation">(</span><span class="token string">"Iteration "</span> <span class="token operator">+</span> iter <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> itResult<span class="token punctuation">.</span><span class="token function">durDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">,</span> itResult<span class="token punctuation">,</span> bmResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// This is an autorun break</span>
            <span class="token comment">// Check for run time threshold termination of sequence</span>
            <span class="token comment">// If we haven't improved more than 1% compared to the two previous one.</span>
            <span class="token comment">// Time to call it a day.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>iter <span class="token operator">&gt;=</span> miniter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>itResult<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1.01d</span> <span class="token operator">*</span> preRes1 <span class="token operator">&amp;&amp;</span> itResult<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1.01d</span> <span class="token operator">*</span> preRes2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            preRes2 <span class="token operator">=</span> preRes1<span class="token punctuation">;</span>
            preRes1 <span class="token operator">=</span> itResult<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>valid <span class="token operator">&amp;&amp;</span> iter <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> maxiter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Skip pause after last iteration.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkForcegc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> bmResult<span class="token punctuation">.</span><span class="token function">getBenchmarkDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Allow a stable state before start.</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationForcegc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Requests gc between iterations."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">runFinalization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* DWM */</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// Allow a period of rest before start.</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Pause for "</span> <span class="token operator">+</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span><span class="token function">millisAsSec</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">sleep</span><span class="token punctuation">(</span>bmResult<span class="token punctuation">.</span><span class="token function">getIterationDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Tear down things for the benchmark (if any).</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">invokeBmTearDownBenchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Error in tear down of Benchmark."</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
            bmResult<span class="token punctuation">.</span><span class="token function">addError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"#### "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getLogicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" exited with exception: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ####\n"</span><span class="token punctuation">;</span>
        bmResult<span class="token punctuation">.</span><span class="token function">addError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valid <span class="token operator">=</span> bmResult<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Errors in benchmark: "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getLogicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> ei <span class="token operator">=</span> bmResult<span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ei<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> ei<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Valid run!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getBoolProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CREATE_XML_REPORT_PROP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bmResult<span class="token punctuation">.</span><span class="token function">footerToXml</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getXmlResultFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">TestResult</span><span class="token punctuation">.</span>TAB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bmResult<span class="token punctuation">.</span><span class="token function">getBmType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">SpecJVMBenchmark</span><span class="token punctuation">.</span>FUNCTIONAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Score on "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">getLogicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> bmResult<span class="token punctuation">.</span><span class="token function">resultString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bmResult<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="测试模式"><a href="#测试模式" class="headerlink" title="测试模式"></a>测试模式</h1><ul>
<li><code>--base</code>：总基础吞吐量测量，从完全兼容的基础运行中获得的总体吞吐量结果，不允许做任何JVM参数调整。（默认）</li>
<li><code>--peak</code>：总峰值吞吐量测量，从完全兼容的峰值运行中获得的总吞吐量结果，可以使用命令行参数和属性文件配置JVM ，还允许反馈优化和代码缓存。peak模式对预热时间或测量间隔没有限制，但是每个工作负载只允许1次测量迭代。</li>
<li><code>--lagom</code>：Lagom工作负载是一个固定大小的工作负载，这意味着它会对每个基准测试执行一定数量的操作。Lagom是基准测试的base模式和peak模式的补充，用于需要运行固定数量的工作时。工作负载将在每个基准测试线程中运行指定数量的操作（每个基准测试的数量不同）。默认情况下，基准测试线程的数量将根据机器的硬件线程数进行调整，因此为了在不同大小的两个不同系统上具有相同数量的工作量，应该设置基准测试线程的数量。<br>Lagom工作负载不符合标准，旨在用于研究用途，作为衡量进展、开销或研究目的的工具。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">base模式</th>
<th align="center">peak模式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">迭代轮次</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">预热时间</td>
<td align="center">120s</td>
<td align="center">随意</td>
</tr>
<tr>
<td align="center">迭代时间</td>
<td align="center">240s</td>
<td align="center">240s或更多</td>
</tr>
<tr>
<td align="center">基准线程数</td>
<td align="center">随意</td>
<td align="center">随意</td>
</tr>
</tbody></table>
<p>若运行模式未设置，需要根据一系列条件判断是base模式还是peak模式。<br>如果满足以下全部条件，则按照base模式运行；否则，按照peak模式运行：</p>
<ul>
<li>未指定JVM参数。</li>
<li>未指定启动JVM选项。</li>
<li>迭代次数为默认值(1次)。</li>
<li>热身时间(120s)和运行时间(240s)为默认值。</li>
</ul>
<h1 id="测试开销"><a href="#测试开销" class="headerlink" title="测试开销"></a>测试开销</h1><p>SPECjvm2008的所有基准测试都需要很少的内核时间，并且CPU几乎总是处于用户模式，利用率不低于99%。SPECjvm2008的I/O开销做到了尽可能小，上下文切换率也较低。值得一提的是，SPECjvm2008上下文切换率最高的基准测试是derby。</p>
<h2 id="上下文切换开销"><a href="#上下文切换开销" class="headerlink" title="上下文切换开销"></a>上下文切换开销</h2><p>SPECjvm2008团队官方提供的一组基准指标数据如下所示（没有startup基准和serial基准）：</p>
<table>
<thead>
<tr>
<th align="center">基准测试</th>
<th align="center">用户模式CPU占有率</th>
<th align="center">内核模式CPU占有率</th>
<th align="center">上下文切换次数/操作次数</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>compiler.compiler</code></td>
<td align="center">99.57%</td>
<td align="center">0.27%</td>
<td align="center">33.92</td>
</tr>
<tr>
<td align="center"><code>compiler.sunflow</code></td>
<td align="center">99.44%</td>
<td align="center">0.41%</td>
<td align="center">30.00</td>
</tr>
<tr>
<td align="center"><code>compress</code></td>
<td align="center">99.93%</td>
<td align="center">0.02%</td>
<td align="center">50.78</td>
</tr>
<tr>
<td align="center"><code>crypto.aes</code></td>
<td align="center">99.94%</td>
<td align="center">0.01%</td>
<td align="center">141.20</td>
</tr>
<tr>
<td align="center"><code>crypto.rsa</code></td>
<td align="center">98.81%</td>
<td align="center">0.87%</td>
<td align="center">137.75</td>
</tr>
<tr>
<td align="center"><code>crypto.signverify</code></td>
<td align="center">99.91%</td>
<td align="center">0.05%</td>
<td align="center">27.60</td>
</tr>
<tr>
<td align="center"><code>derby</code></td>
<td align="center">97.80%</td>
<td align="center">1.06%</td>
<td align="center">2065.01</td>
</tr>
<tr>
<td align="center"><code>mpegaudio</code></td>
<td align="center">99.79%</td>
<td align="center">0.19%</td>
<td align="center">87.01</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.large</code></td>
<td align="center">98.83%</td>
<td align="center">0.22%</td>
<td align="center">1895.77</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.large</code></td>
<td align="center">93.72%</td>
<td align="center">0.08%</td>
<td align="center">5409.42</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.large</code></td>
<td align="center">97.67%</td>
<td align="center">0.09%</td>
<td align="center">1073.89</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.large</code></td>
<td align="center">92.70%</td>
<td align="center">0.35%</td>
<td align="center">1674.87</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.small</code></td>
<td align="center">99.97%</td>
<td align="center">0.01%</td>
<td align="center">6.94</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.small</code></td>
<td align="center">99.92%</td>
<td align="center">0.02%</td>
<td align="center">6.37</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.small</code></td>
<td align="center">99.97%</td>
<td align="center">0.01%</td>
<td align="center">40.97</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.small</code></td>
<td align="center">99.82%</td>
<td align="center">0.03%</td>
<td align="center">59.13</td>
</tr>
<tr>
<td align="center"><code>scimark.monte_carlo</code></td>
<td align="center">99.97%</td>
<td align="center">0.03%</td>
<td align="center">5.71</td>
</tr>
<tr>
<td align="center"><code>sunflow</code></td>
<td align="center">99.45%</td>
<td align="center">0.08%</td>
<td align="center">414.96</td>
</tr>
<tr>
<td align="center"><code>xml.transform</code></td>
<td align="center">88.75%</td>
<td align="center">0.71%</td>
<td align="center">417.58</td>
</tr>
<tr>
<td align="center"><code>xml.validation</code></td>
<td align="center">99.93%</td>
<td align="center">0.02%</td>
<td align="center">30.47</td>
</tr>
<tr>
<td align="center"><code>SPECjbb2005</code></td>
<td align="center">99.79%</td>
<td align="center">0.20%</td>
<td align="center">2.00</td>
</tr>
<tr>
<td align="center"><code>SPECjAppServer2004</code></td>
<td align="center">78.63%</td>
<td align="center">19.50%</td>
<td align="center">37.00</td>
</tr>
</tbody></table>
<h2 id="垃圾收集开销"><a href="#垃圾收集开销" class="headerlink" title="垃圾收集开销"></a>垃圾收集开销</h2><p>SPECjvm2008着重分析了与GC相关的MB/S、MB/OP、GC%三个指标。</p>
<ul>
<li>MB/S：MB/S代表每秒分配的内存总量大小，可以用来衡量内存分配的速度和频率。较高的MB/S值表示程序在较短的时间内分配了大量的内存，可能意味着程序对内存的需求较高或者存在内存泄漏等问题。</li>
<li>MB/OP：MB/OP代表每个操作分配的平均内存大小，可以用来衡量单个操作对内存的消耗情况。具体的操作可以是方法调用、对象创建或其他需要内存分配的操作。较高的MB/OP值可能表示某些操作需要较大的内存空间，可能需要进一步优化以减少内存的使用。</li>
<li>GC%：GC%代表在一定时间内进行垃圾回收的次数或占总执行时间的比例，反映了垃圾回收的频繁程度。GC率的高低与程序的内存使用情况有关。如果GC率较高，意味着垃圾回收发生频繁，可能说明程序在执行过程中产生了大量的临时对象或者存在内存泄漏等问题。这可能会导致较长的停顿时间，影响程序的性能和响应速度。如果GC率较低，即垃圾回收发生较少的次数或占总执行时间的比例较小，可以认为程序的内存使用较为有效，内存中的对象得到了有效的管理和释放，减少了不必要的资源浪费。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">基准测试</th>
<th align="center">内存分配MB/S</th>
<th align="center">内存分配MB/OP</th>
<th align="center">垃圾收集使用率</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>compiler.compiler</code></td>
<td align="center">2422.45</td>
<td align="center">155.10</td>
<td align="center">3.97%</td>
</tr>
<tr>
<td align="center"><code>compiler.sunflow</code></td>
<td align="center">2590.88</td>
<td align="center">143.27</td>
<td align="center">2.31%</td>
</tr>
<tr>
<td align="center"><code>compress</code></td>
<td align="center">141.04</td>
<td align="center">13.72</td>
<td align="center">0.07%</td>
</tr>
<tr>
<td align="center"><code>crypto.aes</code></td>
<td align="center">868.22</td>
<td align="center">237.53</td>
<td align="center">0.16%</td>
</tr>
<tr>
<td align="center"><code>crypto.rsa</code></td>
<td align="center">298.96</td>
<td align="center">9.14</td>
<td align="center">0.02%</td>
</tr>
<tr>
<td align="center"><code>crypto.signverify</code></td>
<td align="center">875.96</td>
<td align="center">44.80</td>
<td align="center">0.05%</td>
</tr>
<tr>
<td align="center"><code>derby</code></td>
<td align="center">3041.56</td>
<td align="center">1058.30</td>
<td align="center">0.46%</td>
</tr>
<tr>
<td align="center"><code>mpegaudio</code></td>
<td align="center">317.34</td>
<td align="center">54.73</td>
<td align="center">0.01%</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.large</code></td>
<td align="center">11.45</td>
<td align="center">44.42</td>
<td align="center">0.05%</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.large</code></td>
<td align="center">8.31</td>
<td align="center">97.04</td>
<td align="center">0.06%</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.large</code></td>
<td align="center">No GC during measurement</td>
<td align="center">No GC during measurement</td>
<td align="center">No GC during measurement</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.large</code></td>
<td align="center">18.27</td>
<td align="center">57.48</td>
<td align="center">0.01%</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.small</code></td>
<td align="center">604.26</td>
<td align="center">8.27</td>
<td align="center">0.04%</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.small</code></td>
<td align="center">1277.90</td>
<td align="center">15.95</td>
<td align="center">0.09%</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.small</code></td>
<td align="center">No GC during measurement</td>
<td align="center">No GC during measurement</td>
<td align="center">No GC during measurement</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.small</code></td>
<td align="center">160.64</td>
<td align="center">18.88</td>
<td align="center">0.01%</td>
</tr>
<tr>
<td align="center"><code>scimark.monte_carlo</code></td>
<td align="center">9.95</td>
<td align="center">0.12</td>
<td align="center">0.03%</td>
</tr>
<tr>
<td align="center"><code>sunflow</code></td>
<td align="center">3405.07</td>
<td align="center">1097.76</td>
<td align="center">0.32%</td>
</tr>
<tr>
<td align="center"><code>xml.transform</code></td>
<td align="center">2832.37</td>
<td align="center">109.14</td>
<td align="center">0.27%</td>
</tr>
<tr>
<td align="center"><code>xml.validation</code></td>
<td align="center">2343.78</td>
<td align="center">126.39</td>
<td align="center">0.38%</td>
</tr>
<tr>
<td align="center"><code>SPECjbb2005</code></td>
<td align="center">3655.00</td>
<td align="center">0.01</td>
<td align="center">2.20%</td>
</tr>
<tr>
<td align="center"><code>SPECjAppServer2004</code></td>
<td align="center">1100.00</td>
<td align="center">0.55</td>
<td align="center">7.50%</td>
</tr>
</tbody></table>
<p>SPECjvm2008团队没有监测到<code>scimark.sor.large</code>和<code>scimark.sor.small</code>基准测试过程中的GC行为。多数基准测试的GC率低于0.1%，但<code>compiler.compiler</code>和<code>compiler.sunflow</code>基准测试的GC率明显偏高。</p>
<p><code>derby</code>、<code>sunflow</code>、<code>xml.transform</code>、<code>xml.validation</code>这4项基准测试表现出了较高的内存分配率和较低的垃圾收集使用率。由于调用GC的速率与内存分配速率直接相关，因此它们运行时GC速率较快，而GC花费的时间较少。</p>
<h2 id="CPI与Pathlength"><a href="#CPI与Pathlength" class="headerlink" title="CPI与Pathlength"></a>CPI与Pathlength</h2><p>CPI（Cycles Per Instruction）是计算机体系结构和处理器性能的指标之一，它表示执行一条指令所需的平均时钟周期数，用于衡量程序执行的效率和处理器的性能。较低的CPI值表示指令执行效率高，每条指令完成所需的时钟周期较少，而较高的CPI值则表示指令执行效率较低，每条指令完成所需的时钟周期较多。</p>
<p>CPI的计算公式为：CPI=CPU时钟周期数/CPU执行的指令数</p>
<p>根据SPECjvm2008团队的研究结果，一些没有较低内存带宽要求的工作负载具有较低的CPI，具有较高CPI的工作负载显示出非常低的带宽需求。</p>
<p>Pathlength是软件工程的静态度量指标之一，它表示计算机程序中执行某个特定任务或代码段所经过的路径的长度。路径长度通常用于评估和比较不同程序或代码段之间的复杂性和执行效率。通过分析和优化路径长度，可以提高程序的性能和可维护性。</p>
<p>在程序执行过程中，每个语句和分支都会构成程序的一部分路径。路径长度是通过计算执行路径上的语句和分支数量来衡量的。路径长度可以用于衡量代码的复杂性，因为路径越长，程序的逻辑就越复杂。同时，路径长度也可以用于评估代码的执行效率，因为路径越长，执行过程中需要经过的操作就越多，可能导致程序的执行时间变长。</p>
<h1 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h1><h2 id="测试结果文件"><a href="#测试结果文件" class="headerlink" title="测试结果文件"></a>测试结果文件</h2><p>单次测试产物如下：</p>
<ul>
<li><code>SPECjvm2008.&lt;num&gt;.raw</code></li>
<li><code>SPECjvm2008.&lt;num&gt;.html</code></li>
<li><code>SPECjvm2008.&lt;num&gt;.txt</code></li>
<li><code>SPECjvm2008.&lt;num&gt;.sub</code></li>
<li><code>SPECjvm2008.&lt;num&gt;.summary</code></li>
</ul>
<p>就此的一些说明：</p>
<ul>
<li>raw文件是在运行结束时从基准测试内部数据结构中的数据生成的，用于提交给SPEC。</li>
<li>txt文件和html文件包含相同的基本信息，用于测试者查看。</li>
<li>如果html结果文件存在，还会有一个images子目录存放html中的图像。</li>
</ul>
<h2 id="测试评分数据"><a href="#测试评分数据" class="headerlink" title="测试评分数据"></a>测试评分数据</h2><p>在性能测试中，通常会模拟真实场景下的负载并执行一系列操作，如请求处理、数据读写、计算等。通过测量在一分钟内完成的操作数，可以评估系统的处理能力和性能。SPECjvm2008选择opm/s作为度量吞吐量的单位。</p>
<p>ops/m是性能测试中的一个常见指标，表示每分钟完成的操作数（Operations Per Minute）。它用于衡量系统或应用程序在单位时间内能够处理的操作数量。较高的ops/m值表示系统具有更高的吞吐量和处理能力，能够在单位时间内处理更多的请求或操作。</p>
<p>SPECjvm2008对不同基准测试组的分数采用几何平均数来整合，计算公式为：$Score=\sqrt[k]{\sqrt[n_{1}]{X_{11}…X_{1n1}}…\sqrt[n_{k}]{X_{k1}…X_{knk}}}$。</p>
<p>根据<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mean">Wikipedia</a>的记录，平均数主要包括：</p>
<ul>
<li>Arithmetic Mean（算术平均数）：<ul>
<li>计算方法：将一组数据的所有值相加，然后除以数据个数。</li>
<li>用途：用于计算数据的集中趋势，常用于描述一组数据的平均值。</li>
</ul>
</li>
<li>Arithmetic-Geometric Mean（算术-几何平均数）：<ul>
<li>计算方法：迭代计算算术平均数和几何平均数，直到收敛到一个特定值。</li>
<li>用途：用于解决某些数学问题，如计算无理数的近似值等。</li>
</ul>
</li>
<li>Cubic Mean（立方平均数）：<ul>
<li>计算方法：将一组数据的所有值的立方相加，然后除以数据个数，再取立方根。</li>
<li>用途：用于描述数据的集中趋势，对数据中较大值的影响更为敏感。</li>
</ul>
</li>
<li>Generalized/Power Mean（幂平均数）：<ul>
<li>计算方法：对一组数据的所有值进行幂运算（指定幂次），然后计算平均值。</li>
<li>用途：用于计算数据集合的平均值，幂次可以控制对数据的敏感程度。</li>
</ul>
</li>
<li>Geometric Mean（几何平均数）：<ul>
<li>计算方法：将一组数据的所有值相乘，然后开根号（取乘积的n次方根，其中n为数据个数）。</li>
<li>用途：用于计算数据的比例关系和增长率，适用于正数数据。</li>
</ul>
</li>
<li>Harmonic Mean（调和平均数）：<ul>
<li>计算方法：将一组数据的倒数相加，然后取倒数的平均值。</li>
<li>用途：用于计算频率、速率和比率相关的数据，对较小值较为敏感。</li>
</ul>
</li>
<li>Heronian Mean（Heronian平均数）：<ul>
<li>计算方法：一种特殊形式的平均数，用于计算三个数的平均值。</li>
<li>用途：常用于几何学和三角学中的特定计算。</li>
</ul>
</li>
<li>Heinz Mean（Heinz平均数）：<ul>
<li>计算方法：一种平均数定义，涉及素数分解和整数划分。</li>
<li>用途：主要用于研究数论和数学中的特殊问题。</li>
</ul>
</li>
<li>Lehmer Mean（Lehmer平均数）：<ul>
<li>计算方法：一种平均数定义，涉及整数划分和多项式。</li>
<li>用途：主要用于研究数论和数学中的特殊问题。</li>
</ul>
</li>
</ul>
<p>对于其中更常见的算术平均数、几何平均数、调和平均数，其优劣势与适用场景各不相同，具体选择哪种平均数取决于数据的特点和分析的目的。</p>
<ul>
<li>算术平均数：<ul>
<li>优势：算术平均数是最常见和易于理解的平均数。它对异常值的影响较小，能够较好地代表数据的集中趋势。</li>
<li>劣势：算术平均数对极端值较为敏感，受到极大或极小值的影响，可能不适用于偏斜或存在异常值的数据集。</li>
<li>适用场景：如果数据集没有明显的异常值，并且数据分布接近正态分布，则算术平均数是一个常用的选择。</li>
</ul>
</li>
<li>几何平均数：<ul>
<li>优势：几何平均数适用于对数值进行比例分析的情况，尤其在涉及增长率或比率的数据中非常有用。它对数据的乘积更敏感，因此能够平衡不同数据之间的影响。</li>
<li>劣势：几何平均数对负数或零值无法计算，且较算术平均数更复杂，不太直观。</li>
<li>适用场景：如果数据涉及比例、增长率或速率，而且数据集中存在较大的差异或极端值，那么几何平均数可能更合适。</li>
</ul>
</li>
<li>调和平均数：<ul>
<li>优势：调和平均数在处理比例或速度相关的数据时很有用。它对极大或极小值较为敏感，能够突出较小值的影响。</li>
<li>劣势：调和平均数对极端值和非正数值（零和负数）很敏感，且较算术平均数和几何平均数更复杂，不太直观。</li>
<li>适用场景：如果数据集涉及比率、频率或速率，并且对较小值较为敏感，调和平均数可能是更恰当的选择。</li>
</ul>
</li>
</ul>
<p>当单个workload经历多次迭代轮次时，SPECjvm2008会选择其中的最大值作为score结果。</p>
<p>SPECjvm2008团队官方提供的一组baseline数据如下所示：</p>
<table>
<thead>
<tr>
<th align="center">工作负载</th>
<th align="center">测试得分</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>compiler.compiler</code></td>
<td align="center">937.23</td>
</tr>
<tr>
<td align="center"><code>compiler.sunflow</code></td>
<td align="center">1119.25</td>
</tr>
<tr>
<td align="center"><code>compress</code></td>
<td align="center">614.14</td>
</tr>
<tr>
<td align="center"><code>crypto.aes</code></td>
<td align="center">214.77</td>
</tr>
<tr>
<td align="center"><code>crypto.rsa</code></td>
<td align="center">2012.82</td>
</tr>
<tr>
<td align="center"><code>crypto.signverify</code></td>
<td align="center">1173.08</td>
</tr>
<tr>
<td align="center"><code>derby</code></td>
<td align="center">174</td>
</tr>
<tr>
<td align="center"><code>mpegaudio</code></td>
<td align="center">350.44</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.large</code></td>
<td align="center">15.49</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.large</code></td>
<td align="center">5.14</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.large</code></td>
<td align="center">25.99</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.large</code></td>
<td align="center">18.93</td>
</tr>
<tr>
<td align="center"><code>scimark.fft.small</code></td>
<td align="center">4384.62</td>
</tr>
<tr>
<td align="center"><code>scimark.lu.small</code></td>
<td align="center">4903.85</td>
</tr>
<tr>
<td align="center"><code>scimark.sor.small</code></td>
<td align="center">713.61</td>
</tr>
<tr>
<td align="center"><code>scimark.sparse.small</code></td>
<td align="center">509.41</td>
</tr>
<tr>
<td align="center"><code>scimark.monte_carlo</code></td>
<td align="center">4903.85</td>
</tr>
<tr>
<td align="center"><code>sunflow</code></td>
<td align="center">195.7</td>
</tr>
<tr>
<td align="center"><code>xml.transform</code></td>
<td align="center">1540.12</td>
</tr>
<tr>
<td align="center"><code>xml.validation</code></td>
<td align="center">1117.91</td>
</tr>
</tbody></table>
<p>SPECjvm2008团队观察到相当数量的结果数据波动，波动幅度偶尔超过5%。</p>
<p>SPECjvm2008每个基准测试的分数都采用ops/m作为统一度量标准。而根据上表显示的结果，<code>scimark.lu.large</code>的结果数据只有5.14ops/m，反观<code>scimark.lu.small</code>和<code>scimark.monte_carlo</code>的结果数据分别高达4903.85ops/m和4903.85ops/m，这种差异是显著的。这种显著的差异是SPECjvm2008团队选择几何平均数而非算术平均数的重要原因。</p>
<p>与此同时，这样做意味着仅影响1项基准测试组的平台改进不太可能改变SPECjvm2008基准测试获得的总体指标。例如，将<code>derby</code>基准测试的性能提高一倍，同时保持其他组件不变，只能将SPECjvm2008的性能提升6%。</p>
<p>想要了解score计算的实现代码，我们可以关注SPECjvm2008的<code>spec.reporter.BenchmarkGroupRecords</code>类。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BenchmarkGroupRecords</span> <span class="token punctuation">{</span>	
    <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">&gt;</span></span> groupRecords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">int</span>  validBenchmarksNumber<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> allBenchmarksValid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> scores <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
 
    <span class="token keyword">void</span> <span class="token function">addNewBenchmarkRecord</span><span class="token punctuation">(</span><span class="token class-name">BenchmarkRecord</span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">isValidRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CHECK_BNAME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>CHECK_BNAME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		    validBenchmarksNumber <span class="token operator">++</span><span class="token punctuation">;</span>
    		<span class="token punctuation">}</span>    		
    	<span class="token punctuation">}</span>
    	allBenchmarksValid <span class="token operator">=</span> allBenchmarksValid <span class="token operator">&amp;&amp;</span> record<span class="token punctuation">.</span><span class="token function">isValidRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    	
    	<span class="token keyword">int</span> index <span class="token operator">=</span> record<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token class-name">String</span> subgroup <span class="token operator">=</span> record<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">isScimarkLarge</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    			subgroup <span class="token operator">+=</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_BNAME_LARGE_POSTFIX<span class="token punctuation">;</span>
    		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">isScimarkSmall</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    			subgroup <span class="token operator">+=</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_BNAME_SMALL_POSTFIX<span class="token punctuation">;</span>    			 
    		<span class="token punctuation">}</span>    
    		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">isScimarkMonteCarlo</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    			<span class="token function">updateGroupRecord</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_SMALL_GNAME<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    			<span class="token function">updateGroupRecord</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>SCIMARK_LARGE_GNAME<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    			<span class="token function">updateGroupRecord</span><span class="token punctuation">(</span>subgroup<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token punctuation">}</span>
    		
    	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    		groupRecords<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>   

    <span class="token keyword">double</span> <span class="token function">computeCompositeScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	
    	<span class="token class-name">Iterator</span> iter <span class="token operator">=</span> groupRecords<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">double</span> product <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    	<span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    	<span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token class-name">BenchmarkGroupRecord</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">)</span>groupRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>bmRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">isCheck</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>bmRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    			<span class="token keyword">double</span> groupScore <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">computeScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    			<span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">dbgPrint</span><span class="token punctuation">(</span><span class="token string">"geo_mean: "</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>groupName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> groupScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		    product <span class="token operator">*=</span> groupScore<span class="token punctuation">;</span>
    		    counter <span class="token operator">++</span><span class="token punctuation">;</span>
    		    scores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>groupName<span class="token punctuation">,</span> groupScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token punctuation">}</span>     
    	<span class="token punctuation">}</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span> 
    	<span class="token keyword">double</span> compositeScore <span class="token operator">=</span> allBenchmarksValid <span class="token operator">?</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>product<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">/</span>counter<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span>INVALID_SCORE<span class="token punctuation">;</span>
    	<span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">dbgPrint</span><span class="token punctuation">(</span><span class="token string">"composite score: "</span> <span class="token operator">+</span> compositeScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">return</span> compositeScore<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateGroupRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">BenchmarkRecord</span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>groupRecords<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		groupRecords<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	groupRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addBenchmarkRecord</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>computeCompositeScore()</code>方法计算来自多个<code>spec.reporter.BenchmarkGroupRecords.BenchmarkGroupRecord</code>的混合分数：</p>
<ol>
<li>通过迭代器遍历<code>groupRecords</code>中的每个键值对，获取每个<code>spec.reporter.BenchmarkGroupRecords.BenchmarkGroupRecord</code>对象。</li>
<li>判断该对象中的<code>bmRecords</code>属性值是否为空（集合中是否存在<code>spec.reporter.BenchmarkRecord</code>元素）且第一个元素不是<code>"check"</code>，如果满足条件，则调用该对象的<code>computeScore()</code>方法计算组得分。</li>
<li>计算组得分后，将得分存入<code>scores</code>中，并将每个组得分累乘到<code>product</code>上，计数器<code>counter</code>记录有效组数。</li>
<li>确认是否所有基准测试都是有效的，如果有效则计算组合得分，否则返回无效得分。</li>
</ol>
<p><code>spec.reporter.BenchmarkGroupRecords.BenchmarkGroupRecord</code>是<code>spec.reporter.BenchmarkGroupRecords</code>的内部类。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BenchmarkGroupRecord</span> <span class="token punctuation">{</span>    
    <span class="token class-name">String</span> groupName<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> isSingleBenchmark<span class="token punctuation">;</span>    
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BenchmarkRecord</span><span class="token punctuation">&gt;</span></span> bmRecords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BenchmarkRecord</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> score<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> isValid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">(</span><span class="token class-name">BenchmarkRecord</span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isSingleBenchmark <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        bmRecords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
        groupName <span class="token operator">=</span> record<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BenchmarkGroupRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        groupName <span class="token operator">=</span> name<span class="token punctuation">;</span>            
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">addBenchmarkRecord</span><span class="token punctuation">(</span><span class="token class-name">BenchmarkRecord</span> bmRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bmRecords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bmRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>            
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token function">computeScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isSingleBenchmark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">BenchmarkRecord</span> record <span class="token operator">=</span> bmRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            score <span class="token operator">=</span> record<span class="token punctuation">.</span>maxScore<span class="token punctuation">;</span>
            isValid <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">isValidRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">double</span> product <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bmRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BenchmarkRecord</span> record <span class="token operator">=</span> bmRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                isValid <span class="token operator">=</span> isValid <span class="token operator">&amp;&amp;</span> record<span class="token punctuation">.</span><span class="token function">isValidRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">dbgPrint</span><span class="token punctuation">(</span><span class="token string">"\t"</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> isValid <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>maxScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
                product <span class="token operator">*=</span> record<span class="token punctuation">.</span>maxScore<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            score <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>product<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">/</span>bmRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        score <span class="token operator">=</span> isValid <span class="token operator">?</span> score <span class="token operator">:</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span>INVALID_SCORE<span class="token punctuation">;</span>
        <span class="token keyword">return</span> score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>spec.reporter.BenchmarkGroupRecords.BenchmarkGroupRecord</code>的关键方法<code>computeScore()</code>计算来自多个<code>spec.reporter.BenchmarkRecord</code>的混合分数：</p>
<ul>
<li>如果是单个基准测试组，则：<ol>
<li>获取第一个基准测试记录。</li>
<li>将第一个基准测试记录的最大得分作为组得分。</li>
<li>判断该记录是否为有效运行。</li>
</ol>
</li>
<li>如果是多个基准测试组，则：<ol>
<li>通过循环遍历每个基准测试记录：<ol>
<li>将其最大得分相乘得到一个累乘积。</li>
<li>判断每个记录是否为有效运行。</li>
</ol>
</li>
<li>计算组得分，使用<code>java.lang.Math.pow()</code>函数对累乘积取几何平均数，并将结果作为组得分。</li>
</ol>
</li>
<li>如果组得分为有效，则返回该得分；否则返回无效得分。</li>
</ul>
<p><code>spec.reporter.BenchmarkGroupRecords.BenchmarkGroupRecord</code>类提供了一个含<code>spec.reporter.BenchmarkRecord</code>类型属性的<code>java.util.ArrayList</code>集合。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BenchmarkRecord</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token class-name">String</span> iterationsInfo<span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IterationRecord</span><span class="token punctuation">&gt;</span></span> iterRecords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IterationRecord</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> maxScore <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token class-name">Utils</span><span class="token punctuation">.</span>BM_CONFIGURATION_ENAMES<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> isSubgroupMember<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BenchmarkRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> numberBmThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        isSubgroupMember <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startHandling</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iterationsInfo <span class="token operator">=</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">IterationRecord</span> <span class="token function">addIterationRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> iter<span class="token punctuation">,</span> <span class="token class-name">String</span> expectedRunTime<span class="token punctuation">,</span> <span class="token class-name">String</span> startTime<span class="token punctuation">,</span> <span class="token class-name">String</span> endTime<span class="token punctuation">,</span> <span class="token class-name">String</span> operations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>WARMUP_RESULT_ENAME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>iterationsInfo<span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token string">"warmup"</span> <span class="token operator">:</span> <span class="token string">"iteration "</span> <span class="token operator">+</span> iter<span class="token punctuation">;</span>
        <span class="token class-name">IterationRecord</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IterationRecord</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> expectedRunTime<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">,</span> operations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"warmup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            maxScore <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxScore<span class="token punctuation">,</span> record<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        iterRecords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> record<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printAllRecordedInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iterRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">IterationRecord</span> record <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IterationRecord</span><span class="token punctuation">)</span>iterRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>iterName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>runTime <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>operations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValidRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iterRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> result <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">IterationRecord</span><span class="token punctuation">)</span>iterRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isValidIteration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>spec.reporter.BenchmarkRecord</code>类提供了一个含<code>spec.reporter.BenchmarkRecord.IterationRecord</code>类型属性的<code>java.util.ArrayList</code>集合，而<code>spec.reporter.BenchmarkRecord.IterationRecord</code>正是<code>spec.reporter.BenchmarkRecord</code>的一个内部类。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IterationRecord</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> runTime<span class="token punctuation">;</span>
    <span class="token class-name">String</span> iterName<span class="token punctuation">;</span>
    <span class="token keyword">double</span> operations<span class="token punctuation">;</span>
    <span class="token keyword">double</span> score<span class="token punctuation">;</span>
    <span class="token class-name">String</span> expectedRunTime<span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">IterationRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> iterName<span class="token punctuation">,</span> <span class="token class-name">String</span> expectedRunTime<span class="token punctuation">,</span> <span class="token class-name">String</span> startTime<span class="token punctuation">,</span> <span class="token class-name">String</span> endTime<span class="token punctuation">,</span> <span class="token class-name">String</span> operations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>iterName <span class="token operator">=</span> iterName<span class="token punctuation">;</span>
        runTime <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operations <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>operations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>operations<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60000</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>runTime<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expectedRunTime <span class="token operator">=</span> expectedRunTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">isValidIteration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errors <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">addError</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errors <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        errors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>reporter.BenchmarkRecord.IterationRecord</code>提供了score属性，用于记录一个<code>spec.reporter.BenchmarkRecord</code>的分数。</p>
<h1 id="标准流程"><a href="#标准流程" class="headerlink" title="标准流程"></a>标准流程</h1><p>产生合规结果的推荐步骤：</p>
<ol>
<li>使用系统和提交信息<code>SPECjvm2008/props/specjvm.reporter.properties</code>为报告者编辑属性文件。这样做是为了确保未在基本运行中设置JVM参数属性和堆大小属性。</li>
<li>使用harness配置<code>SPECjvm2008/props/specjvm.properties</code>编辑reporter的属性文件。一般来说，保留默认值即可，无需修改属性文件。如果修改，需要确保此配置文件指向报告者信息文件，还要确保这不包括对运行时的任何更改。</li>
<li>使用运行脚本或直接从命令行运行base模式： <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar SPECjvm2008.jar --base --propfile props/specjvm.properties<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>更新peak运行的属性文件，包括JVM参数属性的更新。</li>
<li>使用运行脚本或直接从命令行运行peak模式： <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -Xms3000m -Xmx3000m -jar SPECjvm2008.jar --peak --propfile props/specjvm.properties<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>查看<code>SPECjvm2008/results/</code>文件夹中的输出结果。</li>
</ol>
<p>提交合规结果的推荐步骤：</p>
<ol>
<li>生成一个新的raw文件（以前文件的合并版本），然后生成一个包含新raw文件的zip文件。 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar SPECjvm2008.jar --reporter --prepare <span class="token operator">&lt;</span>base raw file<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>optional peak raw file<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>通过将zip文件复制到新位置并运行来检查原始文件，检查的过程中创建一个简短的摘要报告，该报告链接到子文件夹中每次运行的完整报告： <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar SPECjvm2008.jar --reporter --specprocess <span class="token operator">&lt;</span>zip file<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>将此zip文件邮寄到<a href="subjvm2008@spec.org">subjvm2008@spec.org</a>。</li>
</ol>
<h1 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h1><p>测试环境：</p>
<ul>
<li>Machine’s Architecture : x86_64</li>
<li>Operating System : GNU/Linux</li>
<li>OS Kernel Release Number : 5.11.0-37-generic</li>
<li>OS Kernel Version : #41~20.04.2-Ubuntu SMP Fri Sep 24 09:06:38 UTC 2021</li>
<li>CPU Model : Intel(R) Xeon(R) Gold 6226 CPU @ 2.70GHzCPU</li>
<li>CPU Cores : 12</li>
<li>Main Memory Size : 125GB</li>
<li>Graphics Card Version : NVIDIA Corporation TU102 [GeForce RTX 2080 Ti]</li>
<li>JDK Version : jdk-8u371-linux-x64</li>
<li>JRE Version : 1.8.0_371-b11</li>
</ul>
<p>测试命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -Djava.awt.headless<span class="token operator">=</span>true -jar SPECjvm2008.jar -i console -ikv startup.helloworld  startup.compress startup.crypto.aes startup.crypto.rsa startup.crypto.signverify startup.mpegaudio startup.scimark.fft startup.scimark.lu startup.scimark.monte_carlo startup.scimark.sor startup.scimark.sparse startup.serial startup.sunflow startup.xml.validation compress crypto.aes crypto.rsa crypto.signverify derby mpegaudio scimark.fft.large scimark.lu.large scimark.sor.large scimark.sparse.large scimark.fft.small scimark.lu.small scimark.sor.small scimark.sparse.small scimark.monte_carlo serial sunflow xml.validation<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试时间：略小于2h。（跳过了4个workflow）</p>
<p>测试结果：<br><br>测试完成后，前往<code>SPECjvm2008/results/</code>目录下查看测试结果HTML文档。<br><br>Noncompliant composite result : 969.38 ops/m</p>
<p>此系统环境下，内核版本是Ubuntu20.04.2，内核发行号是5.11.0-37-generic，硬件指令集是x86_64，能查找到的linux-tools-5.11.0-37-generic软件包只支持amd64，只不过amd64和x86_64是兼容的。问题会具体表现为：</p>
<ul>
<li>启动<code>perf</code>时提示：  <pre class="line-numbers language-text" data-language="text"><code class="language-text">WARNING: perf not found for kernel 5.11.0-37
  You may need to install the following packages for this specific kernel:
    linux-tools-5.11.0-37-generic
    linux-cloud-tools-5.11.0-37-generic
  You may also want to install one of the following packages to keep up to date:
    linux-tools-generic
    linux-cloud-tools-generic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>以<code>sudo apt install linux-tools-5.11.0-37-generic</code>安装<code>linux-tools-5.11.0-37-generic</code>时报错：  <pre class="line-numbers language-text" data-language="text"><code class="language-text">Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
E: Unable to locate package linux-tools-5.11.0-37-generic
E: Couldn't find any package by glob 'linux-tools-5.11.0-37-generic'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="异常解决"><a href="#异常解决" class="headerlink" title="异常解决"></a>异常解决</h1><p>推荐阅读：<a target="_blank" rel="noopener" href="https://www.spec.org/jvm2008/docs/KnownIssues.html">SPECjvm2008已知问题解决方案</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">BlankSpacePlus</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://blankspaceplus.github.io/2023/08/13/ruan-jian-kai-fa/java/specjvm2008-bi-zhi-bi-hui/">https://blankspaceplus.github.io/2023/08/13/ruan-jian-kai-fa/java/specjvm2008-bi-zhi-bi-hui/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">BlankSpacePlus</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java/">
                                    <span class="chip bg-color">Java</span>
                                </a>
                            
                                <a href="/tags/SPECjvm2008/">
                                    <span class="chip bg-color">SPECjvm2008</span>
                                </a>
                            
                                <a href="/tags/Benchmark/">
                                    <span class="chip bg-color">Benchmark</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/08/22/ruan-jian-kai-fa/git/git-bi-zhi-bi-hui/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="Git必知必会">
                        
                        <span class="card-title">Git必知必会</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文分享Git基础知识及基本操作。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-08-22
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/" class="post-category">
                                    开发技术
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Git/">
                        <span class="chip bg-color">Git</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/07/28/ruan-jian-kai-fa/redis/redis-bi-zhi-bi-hui/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="Redis必知必会">
                        
                        <span class="card-title">Redis必知必会</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文分享一些Redis有效经验。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-07-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/" class="post-category">
                                    开发技术
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/">
                        <span class="chip bg-color">数据库系统</span>
                    </a>
                    
                    <a href="/tags/Redis/">
                        <span class="chip bg-color">Redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 空白格<br />'
            + '文章作者: BlankSpacePlus<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '版权声明：本文为博主「BlankSpacePlus」的原创文章，遵循CC 4.0 BY-SA版权协议，任何形式的转载均请附上原文出处链接及本声明。<br>主页链接：https://blankspaceplus.github.io';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<script src="js/line.js"></script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="8153102324"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.5'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2020-2023</span>
            
            <span id="year">2020</span>
            <a href="/about" target="_blank">BlankSpacePlus</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1018.3k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/BlankSpacePlus" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:blankspaceplus@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
